<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=fpjTOVmNbO4Lz34iLyptLROjXfSpIU_1TsQlCJ7q4WkfnUSgpG7o6Yx3LgtCQhIzcgkv6_KOpC-vO9QMy-VQCA);ol{margin:0;padding:0}table td,table th{padding:0}.c39{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:495.9pt;border-top-color:#000000;border-bottom-style:solid}.c34{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:466.5pt;border-top-color:#000000;border-bottom-style:solid}.c11{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:467.5pt;border-top-color:#000000;border-bottom-style:solid}.c37{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:467pt;border-top-color:#000000;border-bottom-style:solid}.c13{padding-top:2pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:8pt;font-family:"Consolas";font-style:normal}.c5{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Calibri";font-style:normal}.c21{padding-top:0pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c18{padding-top:24pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c19{padding-top:0pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c7{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c9{padding-top:12pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c35{padding-top:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c26{padding-top:6pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c27{padding-top:6pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c41{font-size:9.5pt;font-family:"Consolas";color:#2b91af;font-weight:700}.c16{font-size:8pt;font-family:"Consolas";color:#000000;font-weight:700}.c24{color:#2f5496;font-weight:400;font-size:13pt;font-family:"Calibri"}.c29{color:#000000;font-weight:700;font-size:11pt;font-family:"Calibri"}.c38{color:#2f5496;font-weight:400;font-size:16pt;font-family:"Calibri"}.c0{font-size:9.5pt;font-family:"Consolas";color:#0000ff;font-weight:400}.c33{color:#000000;font-weight:400;font-size:8pt;font-family:"Calibri"}.c12{font-size:9.5pt;font-family:"Consolas";color:#a31515;font-weight:400}.c32{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#0563c1;text-decoration:underline}.c15{font-size:9.5pt;font-family:"Consolas";color:#2b91af;font-weight:400}.c3{font-size:9.5pt;font-family:"Consolas";color:#000000;font-weight:400}.c31{color:#000000;font-weight:700;font-size:9.5pt;font-family:"Calibri"}.c25{font-size:8pt;font-family:"Consolas";color:#a31515;font-weight:700}.c23{border-spacing:0;border-collapse:collapse;margin-right:auto}.c4{font-size:9.5pt;font-family:"Consolas";color:#0000ff;font-weight:700}.c30{font-size:8pt;font-family:"Consolas";color:#0000ff;font-weight:700}.c20{color:#000000;font-weight:400;font-size:9.5pt;font-family:"Calibri"}.c28{font-size:8pt;font-family:"Consolas";color:#a31515;font-weight:400}.c22{font-size:8pt;font-family:"Consolas";color:#0000ff;font-weight:400}.c14{font-size:8pt;font-family:"Consolas";color:#000000;font-weight:400}.c8{font-size:9.5pt;font-family:"Consolas";color:#000000;font-weight:700}.c17{font-size:9.5pt;font-family:"Consolas";color:#a31515;font-weight:700}.c42{font-size:8pt;font-family:"Consolas";color:#2b91af;font-weight:400}.c36{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c6{text-decoration:none;vertical-align:baseline;font-style:normal}.c43{color:inherit;text-decoration:inherit}.c1{height:0pt}.c40{page-break-after:avoid}.c10{height:11pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Calibri"}p{margin:0;color:#000000;font-size:11pt;font-family:"Calibri"}h1{padding-top:12pt;color:#2f5496;font-size:16pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:2pt;color:#2f5496;font-size:13pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:4pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c36 doc-content"><h1 class="c9 c40"><span class="c6 c38">Multiball</span></h1><p class="c19"><span class="c5">The goal is to add a multiball mode to P3SampleApp. </span></p><p class="c19"><span class="c5">This tutorial will start from scratch, from a simplistic implementation working towards a more suitable solution. The code works on all modules so every one can try it. Writing our own code lets us show the entire file at every step. There are still licensing issues with Multimorphic proprietary code like HomeMode. For that, we only show the changes to make.</span></p><p class="c19"><span class="c5">P3SampleApp already comes with a sample Multiball mode. It is rather complex with lots of bells and whistles. The source code is available but the mode is commented out in the app. As much as I think it would be an interesting project to make it work, it is difficult for me to do this right now since the code is specific to the LL-EE module and I don&rsquo;t own that module at the moment. </span></p><p class="c19"><span class="c5">Our mode will be called MultiballMode to distinguish it from P3SampleApp&rsquo;s Multiball mode. You can keep Multiball.cs in the project if you want, but you might as well remove it since it is dead code anyways.</span></p><h2 class="c13"><span class="c24 c6">P3SampleAppAgnostic</span></h2><p class="c19"><span>This tech tip builds on the </span><span class="c32"><a class="c43" href="P3SampleAppOnPhysicalMachine.html">previous tech tip</a></span><span class="c5">&nbsp;which made P3SampleApp playable on the physical machine. We assume you copied P3SampleApp to C:\P3\P3SampleAppAgnostic and you already made the code changes described in that tech tip.</span></p><h2 class="c13"><span class="c6 c24">Simplistic Multiball</span></h2><p class="c19"><span class="c5">To keep things simple, we will not lock balls. Instead, multiball will start when the side targets are completed.</span></p><p class="c19"><span class="c5">HomeMode must create the instance of MultiballMode. </span></p><p class="c19"><span class="c5">Lines in bold indicate changes to the code.</span></p><p class="c35"><span class="c5">Edit Assets\Scripts\Modes\SceneModes\HomeMode.cs, at the top of the class, change this line:</span></p><a id="t.015a1b74bd84cf2093f6a3dd1769baec8d28fa28"></a><a id="t.0"></a><table class="c23"><tr class="c1"><td class="c34" colspan="1" rowspan="1"><p class="c27"><span class="c3 c6">//private Multiball multiball;</span></p></td></tr></table><p class="c35"><span class="c5">to</span></p><a id="t.33449a163c8b4a3795622d60e978076fb8b2c247"></a><a id="t.1"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c27"><span class="c8 c6">private MultiballMode multiball;</span></p></td></tr></table><p class="c18"><span class="c5">In the HomeMode constructor, change this line:</span></p><a id="t.d6e11e3323e5096cdee737983c128dac50c49efa"></a><a id="t.2"></a><table class="c23"><tr class="c1"><td class="c34" colspan="1" rowspan="1"><p class="c27"><span class="c3 c6">//multiball = new Multiball (p3, P3SAPriorities.PRIORITY_MULTIBALL);</span></p></td></tr></table><p class="c35"><span class="c5">to</span></p><a id="t.d7445d1493dc923cd1d76c6e97fb63d162c71f9f"></a><a id="t.3"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c27"><span class="c8 c6">multiball = new MultiballMode(p3, P3SAPriorities.PRIORITY_MULTIBALL);</span></p></td></tr></table><p class="c18"><span class="c5">In mode_stopped(), change this line:</span></p><a id="t.2739ef4f26389650e7edfef511b904009df485f9"></a><a id="t.4"></a><table class="c23"><tr class="c1"><td class="c34" colspan="1" rowspan="1"><p class="c27"><span class="c3 c6">//p3.RemoveMode (multiball);</span></p></td></tr></table><p class="c35"><span class="c5">to</span></p><a id="t.ca638d503858a96aeba12d4cb899c0d8e4b22b53"></a><a id="t.5"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c27"><span class="c8 c6">p3.RemoveMode (multiball);</span></p></td></tr></table><p class="c18"><span class="c5">Change the implementation of SideTargetCompleteEventHandler() to:</span></p><a id="t.ccb93b34f166adcb827c8f22ca55b9fc05f4c24b"></a><a id="t.6"></a><table class="c23"><tr class="c1"><td class="c37" colspan="1" rowspan="1"><p class="c26"><span class="c3">public bool SideTargetCompleteEventHandler(string eventName, object eventData)</span></p><p class="c7"><span class="c3">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; delay(&quot;SideTargetComplete&quot;, NetProc.EventType.None, 2,</span></p><p class="c7"><span class="c3">&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;new Multimorphic.P3.VoidDelegateNoArgs(sideTargetMode.start));</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c8 c6">p3.AddMode(multiball);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; return EVENT_CONTINUE;</span></p><p class="c21"><span class="c3">}</span></p></td></tr></table><p class="c19 c10"><span class="c5"></span></p><p class="c19"><span class="c5">The task of MultiballMode is to launch the additional balls and stop itself when there is only one ball left in play. The drain switch must be handled to count the balls in play and stop the event from reaching HomeMode where it would end the ball.</span></p><p class="c19"><span class="c5">The Multiball mode in P3SampleApp is more complex but fundamentally, it works in a similar way.</span></p><p class="c19"><span class="c5">Create the file Assets\Scripts\Modes\GameModes\MultiballMode.cs with this content:</span></p><a id="t.8b723a26457d52be397e9aef738acb7c0b7e414d"></a><a id="t.7"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c4">using</span><span class="c8 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c4">using</span><span class="c8 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c4">using</span><span class="c8 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c4">using</span><span class="c8 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c4">using</span><span class="c8 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c4">using</span><span class="c8 c6">&nbsp;System;</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c4">namespace</span><span class="c8 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c8 c6">{</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; </span><span class="c4">public</span><span class="c8">&nbsp;</span><span class="c4">class</span><span class="c8">&nbsp;</span><span class="c41">MultiballMode</span><span class="c8 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">const</span><span class="c8">&nbsp;</span><span class="c4">int</span><span class="c8 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">int</span><span class="c8 c6">&nbsp;ballsInPlay;</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">public</span><span class="c8">&nbsp;MultiballMode(P3Controller controller, </span><span class="c4">int</span><span class="c8 c6">&nbsp;priority)</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c4">base</span><span class="c8 c6">(controller, priority)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">public</span><span class="c8">&nbsp;</span><span class="c4">override</span><span class="c8">&nbsp;</span><span class="c4">void</span><span class="c8 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">base</span><span class="c8 c6">.mode_started();</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">for</span><span class="c8">&nbsp;(</span><span class="c4">int</span><span class="c8 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">void</span><span class="c8 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">public</span><span class="c8">&nbsp;</span><span class="c4">bool</span><span class="c8 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">if</span><span class="c8 c6">&nbsp;(ballsInPlay == 1)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; p3.RemoveMode(</span><span class="c4">this</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">return</span><span class="c8 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c8">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets and multiball will run until a single ball is left in play.</span></p><h2 class="c13"><span class="c24 c6">Evt_MultiballEnded</span></h2><p class="c19"><span class="c5">The previous implementation has a problem if the side targets are completed once again when MultiballMode is still running. The error log says: &quot;Attempted to add mode MultiballMode &nbsp;pri=54, already in mode queue&quot;.</span></p><p class="c19"><span class="c5">We need to disable SideTargetMode when MultiballMode is running. This is easy to do but the side targets would not respond anymore and that would be boring. We could implement another mode for the side targets, but that would distract us from our goal.</span></p><p class="c19"><span class="c5">We will keep SideTargetMode in a completed state during multiball, so side targets will score minimal points. The SideTargetMode will be reset when multiball ends.</span></p><p class="c19"><span class="c5">Instead of MultiballMode removing itself from the mode queue, it will send the event EVT_MultiballEnded to tell HomeMode when it ends. When receiving the event, HomeMode will remove MultiballMode. This is the preferred idiom in the SDK. The parent should control the life cycle of its child modes.</span></p><p class="c9"><span class="c5">Edit Assets\Scripts\Modes\SceneModes\HomeMode.cs, in the HomeMode constructor, add this line before the other calls to AddModeEventHandler()</span></p><a id="t.0989ef6fafd9ae694c39b78d4351f9ff9733f859"></a><a id="t.8"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c27"><span class="c8 c6">AddModeEventHandler(&quot;Evt_MultiballEnded&quot;, MultiballEndedEventHandler, Priority);</span></p></td></tr></table><p class="c18"><span class="c5">Change the implementation of SideTargetCompleteEventHandler() to:</span></p><a id="t.ea307784c3d12f12e7f3b026a419e3ee2f9a86be"></a><a id="t.9"></a><table class="c23"><tr class="c1"><td class="c37" colspan="1" rowspan="1"><p class="c26"><span class="c8">public bool SideTargetCompleteEventHandler(string eventName, object eventData)</span></p><p class="c7"><span class="c8">{</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; p3.AddMode(multiball);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; return EVENT_CONTINUE;</span></p><p class="c21"><span class="c8">}</span></p></td></tr></table><p class="c18"><span class="c5">Add the MultiballEndedEventHandler() method below SideTargetCompleteEventHandler():</span></p><a id="t.1bf6173b16677e92f7b07d825257c53691fc7a8a"></a><a id="t.10"></a><table class="c23"><tr class="c1"><td class="c37" colspan="1" rowspan="1"><p class="c26"><span class="c8">public bool MultiballEndedEventHandler(string eventName, object eventData)</span></p><p class="c7"><span class="c8">{</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; p3.RemoveMode(multiball);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; sideTargetMode.start();</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; return EVENT_CONTINUE;</span></p><p class="c21"><span class="c8">}</span></p></td></tr></table><p class="c19 c10"><span class="c5"></span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this.</span></p><a id="t.6e4b51fdb1582dc32e4d0b1696376289c766b669"></a><a id="t.11"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">if</span><span class="c3 c6">&nbsp;(ballsInPlay == 1)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_MultiballEnded&quot;</span><span class="c8 c6">, 0);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">return</span><span class="c3 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3">}</span></p></td></tr></table><p class="c19 c10"><span class="c5"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, hit the side targets for low points during multiball.</span></p><h2 class="c13"><span class="c24 c6">Pending Launches</span></h2><p class="c19"><span class="c5">The previous implementation has a problem if the second ball drains before the third ball is launched successfully. That&rsquo;s because the ballsInPlay drops to 1 even though there are more balls to come. We need to adjust the criteria to take into account the pending launches.</span></p><p class="c19"><span class="c5">Interestingly, the Multiball in P3SampleApp has the same bug. To be fair, it&rsquo;s not clear how likely the bug can occur on the LL-EE module.</span></p><p class="c19"><span class="c5">Notice the multiball will end if both the first and second balls drain before the third ball is launched. That&rsquo;s the desired behavior. For a brief moment, there are no balls in play but the player&rsquo;s ball is still alive. The pending third launch will eventually succeed and call the LaunchCallback on a stopped mode. This can be a big problem in general but it turns out to be harmless in this case. HomeMode keeps a reference to MultiballMode, so the object is not destroyed. The LaunchCallback merely assigns to member variables, so there will never be a NullReferenceException. All is good and the player will continue to play with that ball.</span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.32af07a2647647bab9e37a9c9f2aee80f9d7772d"></a><a id="t.12"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">int</span><span class="c8 c6">&nbsp;pendingLaunches;</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8 c6">pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8 c6">pendingLaunches--;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">if</span><span class="c8 c6">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_MultiballEnded&quot;</span><span class="c3 c6">, 0);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">return</span><span class="c3 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3">}</span></p></td></tr></table><p class="c19 c10"><span class="c5"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, drain the first and/or second ball quickly to see what happens. You might have to remove the glass to test this effectively.</span></p><p class="c19"><span class="c5">For the adventurous, you can replace the third ball launch with a delayed launch to make it easier to test what happens when all the balls drain before the third ball is launched.</span></p><h2 class="c13"><span class="c24 c6">Ball Saver</span></h2><p class="c19"><span class="c5">It is customary for multiball to start with a ball saver. BallSaveMode is always available in P3SampleApp. Starting the ball saver is as simple as sending the Evt_BallSaveAdd event to increase the ball saver timer. If the ball saver is already running, it will increase the timer, otherwise it will start the ball saver with that timeout.</span></p><p class="c19"><span class="c5">The Evt_BallSavePauseUntilGrid tells the ball saver to pause the timer and restart the timer only when at least one ball is over the screen. This is a convenient way to account for the variable time it might take to launch balls.</span></p><p class="c19"><span class="c5">BallSaveMode has a higher priority than MultiballMode. When a ball drains with the ball saver active, BallSaveMode handles the drain event by launching a new ball and stops the event from reaching lower priority modes. MultiballMode is not aware the ball drained and considers the drained ball and the newly launched ball to be the same.</span></p><p class="c19"><span class="c5">Notice it&rsquo;s impossible for MultiballMode to end when the ball saver is still active because sw_drain_active() is not called. This means there is never a need to stop the ball saver when MultiballMode ends. Technically, this might still occur when tilting, but that is handled by the tilt and is not our problem.</span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.278af75902bb32a1b429d5f97a34bdc2580005fb"></a><a id="t.13"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">const</span><span class="c8">&nbsp;</span><span class="c4">int</span><span class="c8 c6">&nbsp;BALL_SAVE_TIME = 10;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;pendingLaunches;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_BallSaveAdd&quot;</span><span class="c8 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_BallSavePauseUntilGrid&quot;</span><span class="c8 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches--;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">if</span><span class="c3 c6">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_MultiballEnded&quot;</span><span class="c3 c6">, 0);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">return</span><span class="c3 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3 c6">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, drain when the ball saver is active and see the balls being relaunched.</span></p><h2 class="c13"><span class="c24 c6">RespawnMode</span></h2><p class="c19"><span class="c5">P3SampleApp has a Respawn award that can be earned by completing the lower lanes 10 times. A Respawn is single use virtual kickback for a ball that drains below the main flippers. RespawnMode has higher priority than MultiballMode and can cause confusion when both are active. In any case, the player would likely prefer to keep the kickback when losing his last ball, not when losing the third ball in multiball.</span></p><p class="c19"><span class="c5">We will disable Respawn when MultiballMode starts and enable it again when MultiballMode ends.</span></p><p class="c19"><span class="c5">We will take this opportunity to turn off the visual feedback when a ball is saved. This feedback can be frequent and distracting during multiball.</span></p><p class="c19"><span class="c5">The Multiball mode in P3SampleApp also disables the lower lanes during multiball. We show how to do this in comments, but this is optional.</span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.a79839ddb572e3dbdfcdc05c567fdb91ae8e6943"></a><a id="t.14"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALL_SAVE_TIME = 10;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;pendingLaunches;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSaveAdd&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSavePauseUntilGrid&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c8">, </span><span class="c4">false</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_RespawnEnable&quot;</span><span class="c8">, </span><span class="c4">false</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c17">&quot;Evt_EnableLanes&quot;</span><span class="c8">, </span><span class="c4">false</span><span class="c8 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches--;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">if</span><span class="c3 c6">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_MultiballEnded&quot;</span><span class="c3 c6">, 0);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c8">, </span><span class="c4">true</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_RespawnEnable&quot;</span><span class="c8">, </span><span class="c4">true</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c17">&quot;Evt_EnableLanes&quot;</span><span class="c8">, </span><span class="c4">true</span><span class="c8 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">return</span><span class="c3 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3 c6">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, drain when the ball saver is active and see the balls being relaunched without the visual feedback. </span></p><h2 class="c13"><span class="c24 c6">Jackpot</span></h2><p class="c19"><span class="c5">Our multiball launches multiple balls but there is nothing new to do in that mode. We want to introduce a jackpot.</span></p><p class="c19"><span class="c5">We will keep the jackpot extremely simple. Hitting the rotating cube will give an extra 40000 points for a total of 50000 points a shot. I know, this game is not balanced: hitting the slingshots is worth more!</span></p><p class="c19"><span class="c5">We will show a Jackpot message when awarding a jackpot. We choose to post Evt_BlinkPopup instead of Evt_ShowPopup to avoid a color bug in TextReceiver that leaves the popup box black.</span></p><p class="c19"><span class="c5">Edit Assets\Scripts\Modes\P3SAScoreValues.cs. Add this line above the other scores. If you deleted Multiball.cs, you can also remove all 6 MULTIBALL scores already in the file.</span></p><a id="t.a247474752a96c8de453d8572b6d2245c0ed9182"></a><a id="t.15"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c27"><span class="c4">public</span><span class="c8">&nbsp;</span><span class="c4">const</span><span class="c8">&nbsp;</span><span class="c4">long</span><span class="c8">&nbsp;MULTIBALL_JACKPOT = 40000;</span></p></td></tr></table><p class="c19 c10"><span class="c5"></span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.cac28dcba7c1ae36ea49769f44db8ec471e5b55b"></a><a id="t.16"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALL_SAVE_TIME = 10;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;pendingLaunches;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddGUIEventHandler(</span><span class="c17">&quot;Evt_TargetHit&quot;</span><span class="c8 c6">, TargetHitEventHandler);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSaveAdd&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSavePauseUntilGrid&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_RespawnEnable&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableLanes&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">public</span><span class="c8">&nbsp;</span><span class="c4">void</span><span class="c8">&nbsp;TargetHitEventHandler(</span><span class="c4">string</span><span class="c8">&nbsp;evtName, </span><span class="c4">object</span><span class="c8 c6">&nbsp;evtData)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_JACKPOT);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_BlinkPopup&quot;</span><span class="c8">, </span><span class="c17">&quot;Jackpot&quot;</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches--;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">if</span><span class="c3 c6">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_MultiballEnded&quot;</span><span class="c3 c6">, 0);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c3">, </span><span class="c0">true</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_RespawnEnable&quot;</span><span class="c3">, </span><span class="c0">true</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableLanes&quot;</span><span class="c3">, </span><span class="c0">true</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">return</span><span class="c3 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3 c6">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, hit the rotating cube to score a jackpot. </span></p><h2 class="c13"><span class="c24 c6">Super Jackpot</span></h2><p class="c19"><span class="c5">Our choice of multiball jackpot was not much different than single ball play. We will introduce a super jackpot when hitting consecutive jackpots within 5 seconds.</span></p><p class="c19"><span class="c5">The MovingTarget is insensitive for 1.5 second after being hit. The super jackpot will therefore be scored when hitting the rotating cube within 1.5 second and 5 seconds of the previous hit.</span></p><p class="c19"><span class="c5">Edit Assets\Scripts\Modes\P3SAScoreValues.cs. Add this line after the MULTIBALL_JACKPOT:</span></p><a id="t.dfd7ad31e3da834dcf01eaf4b446820caa116237"></a><a id="t.17"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c27"><span class="c4">public</span><span class="c8">&nbsp;</span><span class="c4">const</span><span class="c8">&nbsp;</span><span class="c4">long</span><span class="c8">&nbsp;MULTIBALL_SUPER_JACKPOT = 90000;</span></p></td></tr></table><p class="c7 c10"><span class="c3 c6"></span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.b5326a955239314b207f79d0bb753737843e6c66"></a><a id="t.18"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7"><span class="c4">using</span><span class="c8 c6">&nbsp;UnityEngine;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALL_SAVE_TIME = 10;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">const</span><span class="c8">&nbsp;</span><span class="c4">float</span><span class="c8 c6">&nbsp;SUPER_JACKPOT_TIMEOUT = 5.0f;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;pendingLaunches;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">float</span><span class="c8 c6">&nbsp;lastJackpotTime;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddGUIEventHandler(</span><span class="c12">&quot;Evt_TargetHit&quot;</span><span class="c3 c6">, TargetHitEventHandler);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastJackpotTime = </span><span class="c4">float</span><span class="c8">.MinValue;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSaveAdd&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSavePauseUntilGrid&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_RespawnEnable&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableLanes&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3">&nbsp;TargetHitEventHandler(</span><span class="c0">string</span><span class="c3">&nbsp;evtName, </span><span class="c0">object</span><span class="c3 c6">&nbsp;evtData)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">float</span><span class="c8 c6">&nbsp;now = Time.time;</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">if</span><span class="c8 c6">&nbsp;(now - lastJackpotTime &lt; SUPER_JACKPOT_TIMEOUT)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_SUPER_JACKPOT);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_BlinkPopup&quot;</span><span class="c8">, </span><span class="c17">&quot;Super Jackpot&quot;</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">else</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_JACKPOT);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_BlinkPopup&quot;</span><span class="c8">, </span><span class="c17">&quot;Jackpot&quot;</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastJackpotTime = now;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches--;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">if</span><span class="c3 c6">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_MultiballEnded&quot;</span><span class="c3 c6">, 0);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c3">, </span><span class="c0">true</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_RespawnEnable&quot;</span><span class="c3">, </span><span class="c0">true</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableLanes&quot;</span><span class="c3">, </span><span class="c0">true</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">return</span><span class="c3 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3 c6">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, hit the rotating cube to score a jackpot and again between 1.5s and 5s to hit a super jackpot.</span></p><h2 class="c13"><span class="c24 c6">Grace Period</span></h2><p class="c19"><span class="c5">As soon as MultiballMode ends, it is not possible to hit a jackpot anymore. We would like to introduce a small grace period when it is still possible to hit a jackpot.</span></p><p class="c19"><span class="c5">The jackpot is implemented by MultiballMode so this mode must continue to run after a single ball remains in play. During the grace period, MultiballMode must ignore the drain event and let it reach HomeMode to end the ball.</span></p><p class="c19"><span class="c5">We send the Evt_MultiballEnded event when the grace period ends. This will tell HomeMode to remove MultiballMode.</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.4d01056961630c71fc09651b592fca45453b8b0d"></a><a id="t.19"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;System;</span></p><p class="c7"><span class="c0">using</span><span class="c3 c6">&nbsp;UnityEngine;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c0">namespace</span><span class="c3 c6">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c3 c6">{</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">class</span><span class="c3">&nbsp;</span><span class="c15">MultiballMode</span><span class="c3 c6">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;BALL_SAVE_TIME = 10;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">const</span><span class="c3">&nbsp;</span><span class="c0">float</span><span class="c3 c6">&nbsp;SUPER_JACKPOT_TIMEOUT = 5.0f;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">const</span><span class="c8">&nbsp;</span><span class="c4">double</span><span class="c8 c6">&nbsp;GRACE_PERIOD = 2.0;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">int</span><span class="c3 c6">&nbsp;pendingLaunches;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">float</span><span class="c3 c6">&nbsp;lastJackpotTime;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8 c6">&nbsp;bool gracePeriodActive;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;MultiballMode(P3Controller controller, </span><span class="c0">int</span><span class="c3 c6">&nbsp;priority)</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c0">base</span><span class="c3 c6">(controller, priority)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddGUIEventHandler(</span><span class="c12">&quot;Evt_TargetHit&quot;</span><span class="c3 c6">, TargetHitEventHandler);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">override</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;mode_started()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">base</span><span class="c3 c6">.mode_started();</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastJackpotTime = </span><span class="c0">float</span><span class="c3 c6">.MinValue</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c8">gracePeriodActive = </span><span class="c4">false</span><span class="c8 c6">;</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">for</span><span class="c3">&nbsp;(</span><span class="c0">int</span><span class="c3 c6">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSaveAdd&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BallSavePauseUntilGrid&quot;</span><span class="c3 c6">, BALL_SAVE_TIME);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_RespawnEnable&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c12">&quot;Evt_EnableLanes&quot;</span><span class="c3">, </span><span class="c0">false</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3">&nbsp;TargetHitEventHandler(</span><span class="c0">string</span><span class="c3">&nbsp;evtName, </span><span class="c0">object</span><span class="c3 c6">&nbsp;evtData)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">float</span><span class="c3 c6">&nbsp;now = Time.time;</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">if</span><span class="c3 c6">&nbsp;(now - lastJackpotTime &lt; SUPER_JACKPOT_TIMEOUT)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_SUPER_JACKPOT);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BlinkPopup&quot;</span><span class="c3">, </span><span class="c12">&quot;Super Jackpot&quot;</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">else</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_JACKPOT);</span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c12">&quot;Evt_BlinkPopup&quot;</span><span class="c3">, </span><span class="c12">&quot;Jackpot&quot;</span><span class="c3 c6">);</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastJackpotTime = now;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">private</span><span class="c3">&nbsp;</span><span class="c0">void</span><span class="c3 c6">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches--;</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c0">public</span><span class="c3">&nbsp;</span><span class="c0">bool</span><span class="c3 c6">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7 c10"><span class="c8 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">if</span><span class="c8 c6">&nbsp;(gracePeriodActive)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">return</span><span class="c8 c6">&nbsp;SWITCH_CONTINUE;</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">else</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">if</span><span class="c8 c6">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gracePeriodActive = </span><span class="c4">true</span><span class="c8 c6">;</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delay(</span><span class="c17">&quot;gracePeriod&quot;</span><span class="c8 c6">, NetProc.EventType.None, GRACE_PERIOD,</span></p><p class="c7"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new</span><span class="c8 c6">&nbsp;Multimorphic.P3.VoidDelegateNoArgs(EndMultiballGracePeriod));</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">return</span><span class="c8 c6">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c3 c6"></span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">private</span><span class="c8">&nbsp;</span><span class="c4">void</span><span class="c8 c6">&nbsp;EndMultiballGracePeriod()</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_MultiballEnded&quot;</span><span class="c8 c6">, 0);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c8">, </span><span class="c4">true</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c17">&quot;Evt_RespawnEnable&quot;</span><span class="c8">, </span><span class="c4">true</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c17">&quot;Evt_EnableLanes&quot;</span><span class="c8">, </span><span class="c4">true</span><span class="c8 c6">);</span></p><p class="c7"><span class="c8 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c3 c6">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c3 c6">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Start a game, complete the side targets, when there is only one ball left in play, you still have 2s to score jackpots.</span></p><h2 class="c13"><span class="c24 c6">GameAttributes</span></h2><p class="c19"><span class="c5">It would be nice if the player could choose the parameters of MultiballMode to adjust the game difficulty.</span></p><p class="c19"><span class="c5">We will add settings for the multiball ball save time, the multiball grace period and the super jackpot timeout. These are profile settings, so they can be different in each profile. By design, the number of balls in MultiballMode is equal to 3 and this will not be configurable.</span></p><p class="c19"><span class="c5">The multiball ball save time can be between 0 and 15 seconds in 1 second increments. The default is 10 seconds. </span></p><p class="c19"><span class="c5">The multiball grace period can be between 0 and 5 seconds in 1 second increments. The default is 2 seconds.</span></p><p class="c19"><span class="c5">The super jackpoint timeout can be between 0 and 10 seconds in 1 second increments. The default is 5 seconds.</span></p><p class="c35"><span class="c5">Edit Assets\Scripts\Modes\DataManagement\P3SASettingsMode.cs</span></p><p class="c19"><span class="c5">In CreateDefaultAttrs(), add these lines between SideTargetDifficulty and TwitchViewerFeatureTime.</span></p><a id="t.5a3ec6764a9bab9ae076d9671564c7cd9490de84"></a><a id="t.20"></a><table class="c23"><tr class="c1"><td class="c11" colspan="1" rowspan="1"><p class="c26"><span class="c16">InitAttr(37, </span><span class="c25">&quot;MultiballBallSaveTime&quot;</span><span class="c16">, </span><span class="c25">&quot;Multiball Ball Save Time&quot;</span><span class="c16">, </span><span class="c25">&quot;Multiball Ball Save Time&quot;</span><span class="c16">, </span><span class="c25">&quot;Service Menu/Settings/Gameplay/General&quot;</span><span class="c16 c6">, PRW, 10, 0, 15, 1, 10);</span></p><p class="c7"><span class="c16">InitAttr(37, </span><span class="c25">&quot;MultiballGracePeriod&quot;</span><span class="c16">, </span><span class="c25">&quot;Multiball Grace Period&quot;</span><span class="c16">, </span><span class="c25">&quot;Multiball Grace Period&quot;</span><span class="c16">, </span><span class="c25">&quot;Service Menu/Settings/Gameplay/General&quot;</span><span class="c16 c6">, PRW, 2.0f, 0.0f, 5.0f, 1.0f, 2.0f);</span></p><p class="c21"><span class="c16">InitAttr(37, </span><span class="c25">&quot;MultiballSuperJackpotTimeout&quot;</span><span class="c16">, </span><span class="c25">&quot;Multiball Super Jackpot Timeout&quot;</span><span class="c16">, </span><span class="c25">&quot;Multiball Super Jackpot Timeout&quot;</span><span class="c16">, </span><span class="c25">&quot;Service Menu/Settings/Gameplay/General&quot;</span><span class="c16">, PRW, 5.0f, 0.0f, 10.0f, 1.0f, 5.0f);</span></p></td></tr></table><p class="c19 c10"><span class="c5"></span></p><p class="c19"><span class="c5">Edit MultiballMode.cs and change the content to this. </span></p><a id="t.5ff09ed5947ec0584d1686f3f493cb2477309914"></a><a id="t.21"></a><table class="c23"><tr class="c1"><td class="c39" colspan="1" rowspan="1"><p class="c26"><span class="c22">using</span><span class="c2">&nbsp;Multimorphic.NetProcMachine.Machine;</span></p><p class="c7"><span class="c22">using</span><span class="c2">&nbsp;Multimorphic.P3;</span></p><p class="c7"><span class="c22">using</span><span class="c2">&nbsp;System.Collections.Generic;</span></p><p class="c7"><span class="c22">using</span><span class="c2">&nbsp;Multimorphic.P3App.Modes;</span></p><p class="c7"><span class="c22">using</span><span class="c2">&nbsp;Multimorphic.P3App.Modes.Data;</span></p><p class="c7"><span class="c22">using</span><span class="c2">&nbsp;System;</span></p><p class="c7"><span class="c22">using</span><span class="c2">&nbsp;UnityEngine;</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c22">namespace</span><span class="c2">&nbsp;Multimorphic.P3SA.Modes</span></p><p class="c7"><span class="c2">{</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; </span><span class="c22">public</span><span class="c14">&nbsp;</span><span class="c22">class</span><span class="c14">&nbsp;</span><span class="c42">MultiballMode</span><span class="c2">&nbsp;: P3SAGameMode</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c14">&nbsp;</span><span class="c22">const</span><span class="c14">&nbsp;</span><span class="c22">int</span><span class="c2">&nbsp;BALLS_TO_LAUNCH = 2;</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c14">&nbsp;</span><span class="c22">int</span><span class="c2">&nbsp;ballsInPlay;</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c14">&nbsp;</span><span class="c22">int</span><span class="c2">&nbsp;pendingLaunches;</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c14">&nbsp;</span><span class="c22">float</span><span class="c2">&nbsp;lastJackpotTime;</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c2">&nbsp;bool gracePeriodActive;</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">public</span><span class="c14">&nbsp;MultiballMode(P3Controller controller, </span><span class="c22">int</span><span class="c2">&nbsp;priority)</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; : </span><span class="c22">base</span><span class="c2">(controller, priority)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddGUIEventHandler(</span><span class="c28">&quot;Evt_TargetHit&quot;</span><span class="c2">, TargetHitEventHandler);</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">public</span><span class="c14">&nbsp;</span><span class="c22">override</span><span class="c14">&nbsp;</span><span class="c22">void</span><span class="c2">&nbsp;mode_started()</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">base</span><span class="c2">.mode_started();</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay = 1;</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches = BALLS_TO_LAUNCH;</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastJackpotTime = </span><span class="c22">float</span><span class="c2">.MinValue;</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gracePeriodActive = </span><span class="c22">false</span><span class="c2">;</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">for</span><span class="c14">&nbsp;(</span><span class="c22">int</span><span class="c2">&nbsp;i = 0; i &lt; BALLS_TO_LAUNCH; i++)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; P3SABallLauncher.launch(LaunchCallback);</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c30">int</span><span class="c16">&nbsp;ballSaveTime = data.GetGameAttributeValue(</span><span class="c25">&quot;MultiballBallSaveTime&quot;</span><span class="c16 c6">).ToInt();</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c30">if</span><span class="c16 c6">&nbsp;(ballSaveTime &gt; 0)</span></p><p class="c7"><span class="c16 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c25">&quot;Evt_BallSaveAdd&quot;</span><span class="c16 c6">, ballSaveTime);</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c25">&quot;Evt_BallSavePauseUntilGrid&quot;</span><span class="c16 c6">, ballSaveTime);</span></p><p class="c7"><span class="c16 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c16 c6"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c14">, </span><span class="c22">false</span><span class="c2">);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_RespawnEnable&quot;</span><span class="c14">, </span><span class="c22">false</span><span class="c2">);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c28">&quot;Evt_EnableLanes&quot;</span><span class="c14">, </span><span class="c22">false</span><span class="c2">);</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">public</span><span class="c14">&nbsp;</span><span class="c22">void</span><span class="c14">&nbsp;TargetHitEventHandler(</span><span class="c22">string</span><span class="c14">&nbsp;evtName, </span><span class="c22">object</span><span class="c2">&nbsp;evtData)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">float</span><span class="c2">&nbsp;now = Time.time;</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c30">float</span><span class="c16">&nbsp;superJackpotTimeout = data.GetGameAttributeValue(</span><span class="c25">&quot;MultiballSuperJackpotTimeout&quot;</span><span class="c16 c6">).ToFloat();</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c30">if</span><span class="c16 c6">&nbsp;(now - lastJackpotTime &lt; superJackpotTimeout)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_SUPER_JACKPOT);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_BlinkPopup&quot;</span><span class="c14">, </span><span class="c28">&quot;Super Jackpot&quot;</span><span class="c2">);</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">else</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ScoreManager.Score(Scores.MULTIBALL_JACKPOT);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_BlinkPopup&quot;</span><span class="c14">, </span><span class="c28">&quot;Jackpot&quot;</span><span class="c2">);</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; lastJackpotTime = now;</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c14">&nbsp;</span><span class="c22">void</span><span class="c2">&nbsp;LaunchCallback()</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay++;</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; pendingLaunches--;</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">public</span><span class="c14">&nbsp;</span><span class="c22">bool</span><span class="c2">&nbsp;sw_drain_active(Switch sw)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ballsInPlay--;</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">if</span><span class="c2">&nbsp;(gracePeriodActive)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">return</span><span class="c2">&nbsp;SWITCH_CONTINUE;</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">else</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">if</span><span class="c2">&nbsp;(pendingLaunches + ballsInPlay == 1)</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; gracePeriodActive = </span><span class="c22">true</span><span class="c2">;</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c30">float</span><span class="c16">&nbsp;multiballGracePeriod = data.GetGameAttributeValue(</span><span class="c25">&quot;MultiballGracePeriod&quot;</span><span class="c16 c6">).ToFloat(); </span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; delay(</span><span class="c25">&quot;gracePeriod&quot;</span><span class="c16 c6">, NetProc.EventType.None, multiballGracePeriod,</span></p><p class="c7"><span class="c16">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c30">new</span><span class="c16 c6">&nbsp;Multimorphic.P3.VoidDelegateNoArgs(EndMultiballGracePeriod));</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">return</span><span class="c2">&nbsp;SWITCH_STOP;</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7 c10"><span class="c2"></span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c22">private</span><span class="c14">&nbsp;</span><span class="c22">void</span><span class="c2">&nbsp;EndMultiballGracePeriod()</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_MultiballEnded&quot;</span><span class="c2">, 0);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_EnableBallSavedFeedback&quot;</span><span class="c14">, </span><span class="c22">true</span><span class="c2">);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PostModeEventToModes(</span><span class="c28">&quot;Evt_RespawnEnable&quot;</span><span class="c14">, </span><span class="c22">true</span><span class="c2">);</span></p><p class="c7"><span class="c14">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //PostModeEventToModes(</span><span class="c28">&quot;Evt_EnableLanes&quot;</span><span class="c14">, </span><span class="c22">true</span><span class="c2">);</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c7"><span class="c2">&nbsp; &nbsp; }</span></p><p class="c21"><span class="c2">}</span></p></td></tr></table><p class="c7 c10"><span class="c0 c6"></span></p><p class="c19"><span class="c5">Create a package for distribution and install the package on the P3 machine. Select P3SampleApp in the launcher. Open the coin door and press the launch button. The service menu appears. Select Settings/Gameplay/General. Edit the multiball settings to your liking.</span></p><p class="c19"><span class="c5">In the same menu, take this opportunity to change the Side Target Difficulty from 0 (Easy) to 1 (Medium). This will require 4 shots instead of 2 to start multiball. The Easy difficulty is too easy.</span></p><p class="c19"><span class="c5">Start a game, complete the side targets, verify the effect of the settings.</span></p><p class="c19"><span class="c5">That concludes our implementation of MultiballMode.</span></p><h2 class="c13"><span class="c24 c6">P3SampleApp&rsquo;s Multiball</span></h2><p class="c19"><span class="c5">The Multiball mode distributed in P3SampleApp is more complex than MultiballMode. This is understandable since it can do a lot more.</span></p><p class="c19"><span class="c5">P3SampleApp&rsquo;s Multiball qualifies lock lit with the help of a child mode. It collects locked balls to determine when multiball can start. To accomplish this, it has to run even in single ball mode. It needs to control the saucer ship to hold the physical locks. It has to maintain a count of balls in the ship for multi-player games because other players might modify the count. It needs to release the balls from the saucer ship and/or the trough depending on the count. It has a jackpot, super jackpot and super duper jackpot. Shot values depend on previous shots. There is a score multiplier. It remembers if the player completed the mode. It controls some LEDs and some GUI inserts plus it has a light show. It can send a multiball status to the GUI thread to modify the display. There is also a debug mode to show what happens to nearly a dozen events.</span></p></body></html>
