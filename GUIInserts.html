<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=fpjTOVmNbO4Lz34iLyptLROjXfSpIU_1TsQlCJ7q4WkfnUSgpG7o6Yx3LgtCQhIzcgkv6_KOpC-vO9QMy-VQCA);.lst-kix_list_1-3>li:before{content:"\0025cf   "}.lst-kix_list_1-4>li:before{content:"o  "}ul.lst-kix_list_1-0{list-style-type:none}.lst-kix_list_1-7>li:before{content:"o  "}.lst-kix_list_1-5>li:before{content:"\0025aa   "}.lst-kix_list_1-6>li:before{content:"\0025cf   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_list_1-3{list-style-type:none}.lst-kix_list_1-0>li:before{content:"\0025cf   "}ul.lst-kix_list_1-4{list-style-type:none}.lst-kix_list_1-8>li:before{content:"\0025aa   "}ul.lst-kix_list_1-1{list-style-type:none}ul.lst-kix_list_1-2{list-style-type:none}ul.lst-kix_list_1-7{list-style-type:none}.lst-kix_list_1-1>li:before{content:"o  "}.lst-kix_list_1-2>li:before{content:"\0025aa   "}ul.lst-kix_list_1-8{list-style-type:none}ul.lst-kix_list_1-5{list-style-type:none}ul.lst-kix_list_1-6{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c26{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:63.5pt;border-top-color:#000000;border-bottom-style:solid}.c17{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:198.4pt;border-top-color:#000000;border-bottom-style:solid}.c29{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:226.8pt;border-top-color:#000000;border-bottom-style:solid}.c23{margin-left:36pt;padding-top:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left;margin-right:-35.1pt}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9.5pt;font-family:"Consolas";font-style:normal}.c22{padding-top:6pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left;margin-right:-35.1pt}.c8{padding-top:2pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c40{color:#2f5496;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Calibri";font-style:normal}.c20{padding-top:6pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left;margin-right:-35.1pt}.c39{padding-top:2pt;padding-bottom:12pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c14{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Calibri";font-style:normal}.c31{padding-top:0pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left;margin-right:-35.1pt}.c34{margin-left:36pt;padding-top:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c9{color:#2f5496;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:13pt;font-family:"Calibri";font-style:normal}.c4{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Calibri";font-style:normal}.c1{padding-top:12pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c11{padding-top:0pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c28{padding-top:12pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c7{font-size:8pt;font-family:"Consolas";color:#3d578c;font-weight:700;text-decoration:none}.c24{color:#000000;text-decoration:none;vertical-align:baseline;font-style:normal}.c3{font-size:9.5pt;font-family:"Consolas";color:#a31515;font-weight:400}.c35{border-spacing:0;border-collapse:collapse;margin-right:auto}.c5{font-size:9.5pt;font-family:"Consolas";color:#000000;font-weight:400}.c41{font-size:10pt;font-family:"Courier New";color:#000000;font-weight:400}.c10{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#0563c1;text-decoration:underline}.c46{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c38{font-size:9.5pt;font-family:"Consolas";font-weight:700}.c37{font-size:9pt;font-family:"Consolas";font-weight:400}.c33{font-size:9.5pt;font-family:"Consolas";font-weight:400}.c19{font-size:8pt;font-family:"Consolas";font-weight:700}.c42{font-size:9pt;font-family:"Consolas";font-weight:700}.c6{font-size:8pt;font-family:"Consolas";font-weight:400}.c12{margin-left:42.5pt;text-indent:-6.5pt;margin-right:-35.2pt}.c45{padding:0;margin:0}.c47{color:#3d578c;text-decoration:none}.c18{margin-left:42.5pt;text-indent:-42.5pt}.c25{margin-left:56.7pt;text-indent:-21.2pt}.c30{margin-left:36pt;padding-left:0pt}.c21{margin-left:42.5pt;text-indent:29.5pt}.c43{page-break-after:avoid}.c27{height:13pt}.c49{margin-left:36pt}.c16{height:11pt}.c13{height:0pt}.c48{background-color:#e7e6e6}.c15{margin-right:-35.2pt}.c32{text-indent:36pt}.c36{padding-left:0pt}.c44{color:#0000ff}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Calibri"}p{margin:0;color:#000000;font-size:11pt;font-family:"Calibri"}h1{padding-top:12pt;color:#2f5496;font-size:16pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:2pt;color:#2f5496;font-size:13pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:4pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c46 doc-content"><h1 class="c28 c43"><span class="c40">GUIInsert</span></h1><p class="c1"><span class="c4">A GUIInsert is a virtual LED on the playfield or backbox screen. The API is very similar to LEDs.</span></p><p class="c1"><span>See the </span><span class="c10">LEDs section</span><span class="c4">&nbsp;of the SDK Guide for related information.</span></p><h2 class="c8"><span class="c9">Overview</span></h2><p class="c1"><span class="c4">A GUIInsertScript contains the commands to determine what color a single GUIInsert should be over time. A Mode creates a separate GUIInsertScript for each GUIInsert it controls and adds these scripts to GUIInsertControllerMode. The controller orchestrates which scripts are running: for each GUIInsert, the GUIInsertScript with the highest priority is the one that runs. This way, a Mode with higher priority overrides a Mode with lower priority.</span></p><h2 class="c8"><span class="c9">GUIInsert class</span></h2><p class="c1"><span class="c4">The GUIInsert class is never used and can be ignored. The real workhorse is GUIInsertScript.</span></p><h2 class="c8"><span class="c9">GUIInsertScript</span></h2><p class="c1"><span>A </span><span class="c10">GUIInsertScript</span><span class="c4">&nbsp;is a collection of GUIInsertCommands for one GUIInsert and the code to run the commands. The class derives directly from object. Do not confuse it with a Unity Script. To create a GUIInsertScript, call the constructor with the GUIInsert name and the priority of the Mode:</span></p><p class="c1 c32"><span class="c0">GUIInsertScript script = new GUIInsertScript(&quot;insertName&quot;, priority);</span></p><p class="c1"><span class="c4">You can assign a scriptName to the script. This is optional but it can be useful for debugging because the scriptName will appear in some log messages. This can help distinguish multiple scripts for the same insert, for example by including the mode name in the script name. P3SampleApp never bothers to do this, and that&rsquo;s fine too.</span></p><p class="c1 c32"><span class="c33">script.</span><span class="c41">scriptName </span><span class="c0">= &quot;ModeName-InsertName&quot;;</span></p><p class="c1"><span class="c4">A GUIInsertScript starts empty. You add new commands by calling AddCommand():</span></p><p class="c1 c25"><span class="c0">script.AddCommand(&quot;new text&quot;, textColors, colors, alpha, fadeTime, duration);</span></p><p class="c1"><span class="c4">Internally, that creates a GUIInsertCommand which is a data object with no behavior. That&rsquo;s an implementation detail because you never interact with the data type GUIInsertCommand (unless you implement your own receiver).</span></p><p class="c1"><span class="c4">The only two commands available are: change a text string and/or linear interpolate the color of an object. Remember the alpha is part of the color, so you can make objects appear and disappear.</span></p><p class="c1"><span class="c4">You can add multiple commands to a script by calling AddCommand() multiple times. This can create blinking effects.</span></p><p class="c1"><span class="c4">By default, the script is not removed when it finishes execution. This means the GUIInsert will stay the way it is after the last command. The script can be configured to automatically remove itself when execution finishes, like this:</span></p><p class="c1 c32"><span class="c0">script.autoRemove = true;</span></p><p class="c1"><span class="c4">When the script is removed, the next highest priority script is executed and it will likely change the GUIInsert.</span></p><p class="c1"><span class="c4">To add the script to the GUIInsertControllerMode, post an event:</span></p><p class="c1 c32"><span class="c0">EventManager.Post(&quot;Evt_AddGUIInsertScript&quot;, script);</span></p><p class="c1"><span class="c4">&lt;appcode&gt;BaseGameMode handles the event (in its base class BaseAppMode) and calls the GUIInsertControllerMode instance to add the script. The new script will start executing immediately if it has the highest priority for that GUIInsert (stopping the previous script if there was one).</span></p><p class="c1"><span class="c4">I&rsquo;m not sure why GUIInsertControllerMode does not handle the event directly. In any case, the Post is needed because the caller Mode does not have the reference to GUIInsertControllerMode.</span></p><p class="c1"><span class="c4">Nothing stops a mode to add multiple scripts for the same insert at the same priority at the same time. The result is unpredictable and likely a bug in the application.</span></p><p class="c1"><span class="c4">A GUIInsertScript is meant to be reused. The procedure is simple: clear the existing commands, add new ones, then add the script to the controller again. The script will reinitialize itself if it was currently executing.</span></p><p class="c34"><span class="c0">script.Clear();</span></p><p class="c34"><span class="c0">script.AddCommand(&quot;new text&quot;, textColors, colors, alpha, fadeTime, duration);</span></p><p class="c11 c49"><span class="c0">EventManager.Post(&quot;Evt_AddGUIInsertScript&quot;, script);</span></p><p class="c1"><span class="c4">When the Mode no longer wants to control the GUIInsert, it must remove the script from GUIInsertControllerMode by posting an event:</span></p><p class="c1 c32"><span class="c0">EventManager.Post(&quot;Evt_RemoveGUIInsertScript&quot;, script);</span></p><p class="c1"><span class="c4">&lt;appcode&gt;BaseGameMode handles the event (in its base class BaseAppMode) and calls the GUIInsertControllerMode instance to remove the script. The script will stop executing immediately if it had the highest priority for that GUIInsert (and the script with the next highest priority will execute instead). The script will no longer be considered for that GUIInsert.</span></p><p class="c1"><span class="c4">Always remember to remove a script added to GUIInsertControllerMode when no longer needed. In particular, make sure to remove all remaining scripts in mode_stopped() when the Mode ends.</span></p><p class="c1"><span class="c4">A script that was removed can be added later as is, or it can be reused with different commands.</span></p><h2 class="c8"><span class="c9">RegisterGUIInserts</span></h2><p class="c1"><span class="c10">GUIInsertHelpers</span><span class="c4">&nbsp;keeps a list of all GUIInsert names. The list is populated in the RegisterGUIInserts method of &lt;appcode&gt;BaseGameMode. These are the GUIInserts in P3SampleApp:</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; private void RegisterGUIInserts()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c44">base</span><span class="c0">.RegisterGUIInserts();</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;InfoPopup&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight0&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight1&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight2&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight3&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight4&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight5&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight6&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight7&quot;</span><span class="c0">);</span></p><p class="c1"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span><span class="c4">&nbsp;</span></p><p class="c1"><span class="c4">In P3SampleApp, the InfoPopup GUIInsert is used in PopupMode. The SideTargetHighlightN GUIInserts are used in SideTargetMode.</span></p><p class="c1"><span class="c4">Whenever a Mode is created, the P3Mode base class creates a new GUIInsertScript for each registered GUIInsert. These scripts are for the exclusive use of this mode. All the scripts are empty and at the same priority as the Mode. The list of scripts is stored in the field GUIInsertScripts. The same scripts are also stored in the field GUIInsertScriptsDict which is a Dictionary mapping the GUIInsert name to the corresponding script.</span></p><p class="c28"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected List&lt;GUIInsertScript&gt; GUIInsertScripts;</span></p><p class="c11"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;protected Dictionary&lt;string, GUIInsertScript&gt; GUIInsertScriptsDict;</span></p><p class="c1"><span class="c4">This is not mandatory, but it&rsquo;s simpler to reuse the scripts that are already created by the base class. For the GUIInsert named insertName, the mode can access the corresponding script with</span></p><p class="c1 c32"><span class="c0">GUIInsertScriptsDict[&quot;insertName&quot;]</span></p><p class="c1"><span class="c4">The scripts are not automatically added to GUIInsertControllerMode. The Mode must configure the scripts for the GUIInserts it controls. After the Mode is started, it can add these scripts to GUIInsertControllerMode explicitly.</span></p><p class="c1"><span class="c4">When the Mode ends, the SDK automatically removes the scripts from GUIInsertControllerMode. It can do this because it knows the list of all the scripts in the field GUIInsertScripts. This might try to remove some scripts that were never added, but that&rsquo;s not a problem.</span></p><h2 class="c8"><span class="c9">RegisterGUIInserts Workaround</span></h2><p class="c1 c15"><span class="c4">The RegisterGUIInserts() method in P3SABaseGameMode is declared like this:</span></p><p class="c1 c15 c32"><span class="c0">private void RegisterGUIInserts()</span></p><p class="c1 c15"><span class="c4">This is a bug. The private method is never called by the base class. Instead, the method must use the override keyword to override the protected virtual method in the base class:</span></p><p class="c1 c15 c32"><span class="c0">protected override void RegisterGUIInserts()</span></p><p class="c1 c15"><span class="c4">This point is moot though, as we discuss next.</span></p><p class="c1 c15"><span class="c4">If no GUIInsert names have been registered yet, GUIInsertHelpers returns this list:</span></p><p class="c23"><span class="c0">&quot;Lite&quot;, </span></p><p class="c23"><span class="c0">&quot;lIte&quot;, </span></p><p class="c23"><span class="c0">&quot;liTe&quot;, </span></p><p class="c23"><span class="c0">&quot;litE&quot;, </span></p><p class="c23"><span class="c0">&quot;Lock&quot;, </span></p><p class="c23"><span class="c0">&quot;lOck&quot;, </span></p><p class="c23"><span class="c0">&quot;loCk&quot;, </span></p><p class="c23"><span class="c0">&quot;locK&quot;, </span></p><p class="c23"><span class="c0">&quot;InfoPopup&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight0&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight1&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight2&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight3&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight4&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight5&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight6&quot;, </span></p><p class="c23"><span class="c0">&quot;SideTargetHighlight7&quot;</span></p><p class="c1 c15"><span class="c4">The GUIInserts must be registered before the Mode base class can create the correct GUIInsertScripts. RegisterGUIInserts() is called in Start() which is after almost all the modes have been created (including game specific modes like HomeMode).</span></p><p class="c11"><span class="c4">The GUIInserts in P3SampleApp are a subset of the default list, so that still works. The problem will appear if the app defines GUIInserts that are not in the default list.</span></p><p class="c1 c15"><span class="c4">Registering the GUIInserts in the P3SABaseGameMode constructor is too late. We need to register the GUIInserts before the base constructor is called. This can be done with a static constructor because that code is executed when the class is loaded, before any instance can be created.</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; static P3SABaseGameMode()</span></p><p class="c2"><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;InfoPopup&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight0&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight1&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight2&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight3&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight4&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight5&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight6&quot;</span><span class="c0">);</span></p><p class="c2"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; GUIInsertHelpers.AddGUIInsert(</span><span class="c3">&quot;SideTargetHighlight7&quot;</span><span class="c0">);</span></p><p class="c11"><span class="c5">&nbsp; &nbsp; &nbsp; &nbsp; }</span><span class="c4">&nbsp;</span></p><p class="c1 c15"><span class="c4">To avoid duplicates in GUIInsertHelpers, the RegisterGUIInserts() method in P3SABaseGameMode must be removed. The default implementation of the method adds no GUIInserts which is exactly what we want.</span></p><p class="c11"><span class="c4">P3SABaseGameMode is the first mode created when the app starts. This will load the class and execute the static constructor before creating any mode. With this approach, all modes have the correct list of GUIInserts.</span></p><h2 class="c8"><span class="c9">Helper Methods</span></h2><p class="c1"><span class="c4">GUIInsertHelpers got its name because it contains many helper functions. A typical helper function takes an existing GUIInsertScript, clears it, adds some commands to achieve a specific effect and finally adds the newly configured script to GUIInsertControllerMode.</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">OnInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, ushort[] color)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">OnInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, string text, ushort[] textColor, ushort[] color)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">PulseInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, ushort[] pulseColor, ushort[] endColor)</span></p><p class="c1 c15 c18"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">FadeOutInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, ushort[] color, double fadeTime)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">FadeOutInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, string text, ushort[] textColor, ushort[] color, double fadeTime)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">BlinkInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, ushort[] color)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">BlinkInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, ushort[] color, double fadeOnTime, double onTime, double fadeOffTime, double offTime)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">BlinkInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, string text, ushort[] textColor, ushort[] color)</span></p><p class="c1 c18 c15"><span class="c6">static&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c6">&nbsp;</span><span class="c19">BlinkInsert</span><span class="c6">(</span><span class="c7">P3Controller</span><span class="c6">&nbsp;controller,&nbsp;</span><span class="c7">GUIInsertScript</span><span class="c24 c6">&nbsp;script, string text, ushort[] textColor, ushort[] color, double fadeOnTime, double onTime, double fadeOffTime, double offTime)</span></p><p class="c1 c15"><span class="c4">The return value is the GUIInsertScript passed as argument.</span></p><p class="c1 c15"><span class="c4">Since these helper methods add the script to GUIInsertControllerMode, make sure you call them only when the mode is already started. In particular, do not initialize the scripts in the mode constructor with these methods.</span></p><p class="c1 c15"><span class="c4">You will often see this pattern, where the return value is assigned back to the Dictionary:</span></p><p class="c28 c12"><span class="c0">GUIInsertScriptsDict[&quot;insertName&quot;] = GUIInsertHelpers.OnInsert(p3,</span></p><p class="c11 c15 c21"><span class="c0">GUIInsertScriptsDict[&quot;insertName&quot;], color);</span></p><p class="c1 c15"><span class="c4">Unfortunately, this code forgets to update the list in the field GUIInsertScripts. If the return value was a different script, that would break the automatic removal of the scripts when the mode ends. Luckily, the script returned is always the script passed in. We can simplify the statement by removing the assignment:</span></p><p class="c1 c12"><span class="c0">GUIInsertHelpers.OnInsert(p3, GUIInsertScriptsDict[&quot;insertName&quot;], color);</span></p><p class="c1 c18 c15"><span class="c4">GUIInsertHelpers also has this helper method to add or remove a script:</span></p><p class="c1 c12"><span class="c33">static void&nbsp;</span><span class="c38">AddorRemoveScript</span><span class="c33">(</span><span class="c38 c47">GUIInsertScript</span><span class="c0">&nbsp;script, bool run)</span></p><p class="c28 c15"><span>Call </span><span class="c33">GUIInsertHelpers.AddOrRemoveScript(script, true)</span><span class="c4">&nbsp;to post the Evt_AddGUIInsertScript event and thus add the script to GUIInsertControllerMode.</span></p><p class="c11 c15"><span>Call </span><span class="c33">GUIInsertHelpers.AddOrRemoveScript(script, false)</span><span class="c4">&nbsp;to post the Evt_RemoveGUIInsertScript event and thus remove the script from GUIInsertControllerMode.</span></p><p class="c1 c15"><span class="c4">The AdjustColor() method in GUIInsertHelpers reduces the color values to 1/4 the original values if the name contains the keyword &quot;flasher&quot;. This method is a carry-over from LEDHelpers where it makes more sense. &nbsp; </span></p><p class="c1 c15 c32"><span class="c33">static ushort[]&nbsp;</span><span class="c38">AdjustColor</span><span class="c0">(string name, ushort[] startingColor)</span></p><h2 class="c8"><span class="c9">Synchronizers</span></h2><p class="c1 c15"><span class="c4">A synchronizer is an object that can ensure multiple GUIInsertScripts start at the same time. GUIInsertHelpers has two methods to create a synchronizer:</span></p><p class="c1 c18 c15"><span class="c37">static void&nbsp;</span><span class="c42">AddSynchronizerGroup</span><span class="c24 c37">(int index, Double interval)</span></p><p class="c1 c18 c15"><span class="c37">static void&nbsp;</span><span class="c42">AddSynchronizerGroup</span><span class="c24 c37">(int index, Double interval, int dependentIndex)</span></p><p class="c1 c15"><span class="c4">The index is the id of the synchronizer. The scripts reference the synchronizers by their index. The interval is the period between synchronizer firings. The dependentIndex is the index of another synchronizer that must fire for this synchronizer to fire.</span></p><p class="c1"><span class="c4">The value of the synchronizer index is arbitrary. The application can choose any integer as long as it does not collide with an existing synchronizer. It is common to use very small integers.</span></p><p class="c1"><span class="c4">Synchronizers cannot be removed once they are created. Make sure you don&rsquo;t continuously create new synchronizers because that will cause a leak.</span></p><p class="c1"><span class="c4">GUIInsertHelpers.AddSynchronizerGroup() is implemented by posting the Evt_AddGUIInsertSynchronizerGroup event with an array of 3 doubles corresponding to the 3 arguments of AddSynchronizerGroup(). BaseAppMode handles this event and calls AddSynchronizer(index, interval, dependentIndex) directly on the GUIInsertControllerMode instance.</span></p><p class="c1"><span class="c4">To enroll the GUIInsertScript in a synchronizer group, assign the synchronizer index to the script:</span></p><p class="c1"><span class="c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;script.synchronizerIndex = index;</span></p><p class="c1"><span>The </span><span class="c10">GUIInsertScript</span><span class="c4">&nbsp;documentation says the default value of synchronizerIndex is 0, but the real default value is -1. This means the script is not controlled by any synchronizer unless its synchronizerIndex is assigned.</span></p><p class="c1"><span class="c4">Think of it this way for the case without a dependentIndex. The synchronizer defines a set of GUIInsertScripts. The synchronizer fires at regular intervals. When the synchronizer fires, it adds all its GUIInsertScripts to GUIInsertControllerMode. If the scripts were currently executing (because they took longer than the interval), they get reinitialized to the beginning. The controller sorts all the scripts by GUIInsert and priority. For each GUIInsert, the script with the highest priority is the one that runs (not necessarily what was just added by the synchronizer).</span></p><p class="c1"><span class="c10">delayedGUIInsertScript</span><span class="c4">&nbsp;is an internal data object used by GUIInsertControllerMode to manage the execution delay caused by a Synchronizer interval. This is an implementation detail because you never interact with that class.</span></p><h2 class="c8"><span class="c9">Evt_RunGUIInsertCommand&lt;insertName&gt;</span></h2><p class="c1"><span class="c4">When a GUIInsertScript is selected for execution, it runs its commands one after the other.</span></p><p class="c1"><span class="c4">To execute a GUIInsertCommand, the script posts the mode to GUI event Evt_RunGUIInsertCommand&lt;insertName&gt; with the GUIInsertCommand as the event data. Notice how the insertName is appended to the event name. This way the event goes directly to the intended GUI Component without bothering other objects.</span></p><p class="c1"><span class="c4">The GUI components that can handle the event are: ColorReceiver and TextReceiver.</span></p><p class="c1"><span class="c4">GUIInsertColorChanger can also handle the event but it is obsolete. Use ColorReceiver and/or TextReceiver instead.</span></p><h2 class="c8"><span class="c9">ColorReceiver</span></h2><p class="c1"><span>The </span><span class="c10">ColorReceiver</span><span class="c4">&nbsp;component can be added to a GameObject to handle the color changing requests coming from GUIInsertScripts. This component expects a Renderer, Image, RawImage and/or Button on the same GameObject. It can also use an optional Material component directly on the game object to override the Renderer&#39;s Material.</span></p><p class="c1"><span class="c4">In the Inspector, set the ColorReceiver id to the GUIInsert name.</span></p><p class="c1"><span class="c4">ColorReceiver handles the Evt_RunGUIInsertCommand&lt;id&gt; event expecting a GUIInsertCommand in the event data. It executes the command by doing the linear interpolation of the color.</span></p><p class="c1"><span class="c4">ColorReceiver handles the Evt_State&lt;id&gt; event expecting a bool as event data. Pass true to enable the Renderer, false to disable it. LanesMode and HUDMode are examples of modes posting the Evt_State&lt;id&gt; event.</span></p><h2 class="c8"><span class="c9">TextReceiver</span></h2><p class="c1"><span>The </span><span class="c10">TextReceiver</span><span class="c4">&nbsp;component can be added to a GameObject to handle text string and color changing requests coming from GUIInsertScripts. This component expects a Text or TextMesh on the same GameObject.</span></p><p class="c1"><span class="c4">In the Inspector, set the TextReceiver id to the GUIInsert name. Also specify whether to updateMaterialColor, the defaultFontSize, whether to adjustFontSizePerBounds, and the bounds.</span></p><p class="c1"><span class="c4">TextReceiver handles the Evt_RunGUIInsertCommand&lt;id&gt; and Evt_State&lt;id&gt; events like ColorReceiver.</span></p><p class="c1"><span class="c4">TextReceiver also handles the Evt_Text&lt;id&gt; event expecting a text string as event data. The TextReceiver reacts by changing the text on the Text or TextMesh component.</span></p><h2 class="c8"><span class="c9">GUIInsert Prefab</span></h2><p class="c11"><span class="c4">There is no GUIInsert Prefab. You will have to create your own if you have multiple GUIInserts in your scenes. Take clues from the two examples below.</span></p><p class="c1"><span class="c4">You can see a ColorReceiver in the HomeScene at the path Home/SideTargets/Highlights/SideTargetHighlight0</span></p><p class="c1"><span class="c4">You can see a TextReceiver in the HomeScene at the path Home/ApronDisplay/BallNumber</span></p><h2 class="c8"><span class="c9">Modes Using GUIInserts</span></h2><p class="c1"><span class="c4">Here is a list of modes that use GUIInserts one way or another.</span></p><p class="c1"><span class="c10">GUIInsertControllerMode</span><span class="c4">&nbsp;orchestrates the execution of the scripts.</span></p><p class="c1"><span class="c10">BaseAppMode</span><span class="c4">&nbsp;creates the BaseGUIInserts mode and the GUIInsertControllerMode. It handles the Evt_AddGUIInsertScript, Evt_RemoveGUIInsertScript, Evt_AddGUIInsertSynchronizerGroup by making the corresponding call directly on the GUIInsertControllerMode instance.</span></p><p class="c1"><span class="c10">BaseGUIInserts</span><span class="c4">&nbsp;mode blackens all GUIInserts when it starts.</span></p><p class="c1"><span class="c10">BonusMode</span><span class="c4">&nbsp;blackens all GUIInserts when it starts.</span></p><p class="c28"><span class="c10">PopupMode</span><span class="c4">&nbsp;handles these events:</span></p><ul class="c45 lst-kix_list_1-0 start"><li class="c28 c30 li-bullet-0"><span class="c4">Evt_ShowPopup takes a text string as event data and displays it in the InfoPopup GUIInsert for the duration given by the settings &ldquo;Service Menu/Settings/Debug/Duration of Popup Messages&rdquo;</span></li><li class="c34 c36 li-bullet-0"><span class="c4">Evt_BlinkPopup is like Evt_ShowPopup except the text message is blinking.</span></li><li class="c11 c30 li-bullet-0"><span class="c4">Evt_HidePopup ignores its event data and removes the InfoPopup GUIInsert immediately.</span></li></ul><p class="c11"><span class="c4">Many modes send these events to show a diagnostic or error message.</span></p><p class="c1"><span class="c10">SideTargetMode</span><span class="c4">&nbsp;controls the SideTargetHighlights, blinking when unhit, steady on when hit, off when all targets are complete.</span></p><p class="c1"><span class="c10">RGBFadeMode</span><span class="c4">&nbsp;in LightShows.cs turns a list of GUIInserts red, green, blue and black in sequence.</span></p><p class="c1"><span class="c10">HomeMode</span><span>, </span><span class="c10">P3SAAttractMode</span><span>&nbsp;and </span><span class="c10">SceneMode</span><span class="c4">&nbsp;blacken all GUIInserts when the scene goes live.</span></p><h2 class="c8 c27"><span class="c9"></span></h2><p class="c11 c16"><span class="c4"></span></p><h2 class="c39"><span class="c9">Appendix: Comparison of GUIInsertScripts vs LEDScripts</span></h2><a id="t.2474bb3ddd17afb013deb9186a4cb314bf2aa182"></a><a id="t.0"></a><table class="c35"><tr class="c13"><td class="c26 c48" colspan="1" rowspan="1"><p class="c22 c16"><span class="c14"></span></p></td><td class="c29 c48" colspan="1" rowspan="1"><p class="c22"><span class="c14">GUIInsert</span></p></td><td class="c17 c48" colspan="1" rowspan="1"><p class="c22"><span class="c14">LEDs</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c22"><span class="c14">Script Class</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">GUIInsertScripts</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">LEDScripts</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c22"><span class="c14">Declaration</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">RegisterGUIInserts()</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c14">Base machine definition and module definition file</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c22"><span class="c14">Dictionary</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">GUIInsertScriptsDict[&quot;name&quot;]</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">p3.LEDs[&quot;name&quot;]</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c20"><span class="c14">default</span></p><p class="c31"><span class="c14">autoRemove</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">false</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">true</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c20"><span class="c14">Controller</span></p><p class="c31"><span class="c14">Mode</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">GUIInsertControllerMode</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">LEDControllerMode</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c22"><span class="c14">Add</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c6 c24">GUIInsertHelpers.AddOrRemoveScript(script, true)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">p3.LEDController.AddScript(script, -1, 0)</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c22"><span class="c14">Remove</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">GUIInsertHelpers.AddOrRemoveScript(script, false)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c22"><span class="c24 c6">p3.LEDController.RemoveScript(script)</span></p></td></tr><tr class="c13"><td class="c26" colspan="1" rowspan="1"><p class="c22"><span class="c14">Synchronizer</span></p></td><td class="c29" colspan="1" rowspan="1"><p class="c20"><span class="c24 c6">GUIInsertHelpers.AddSynchronizerGroup(</span></p><p class="c31"><span class="c24 c6">&nbsp; &nbsp; index, interval, dependentIndex)</span></p></td><td class="c17" colspan="1" rowspan="1"><p class="c20"><span class="c24 c6">p3.LEDController.AddSynchronizer(</span></p><p class="c31"><span class="c24 c6">&nbsp; &nbsp; index, interval, dependentIndex)</span></p></td></tr></table><p class="c1 c16 c15"><span class="c4"></span></p></body></html>