<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=fpjTOVmNbO4Lz34iLyptLROjXfSpIU_1TsQlCJ7q4WlXEixY9aqhie8CVYCrTb1E);.lst-kix_list_2-6>li:before{content:"\0025cf   "}.lst-kix_list_2-7>li:before{content:"o  "}ul.lst-kix_list_1-0{list-style-type:none}.lst-kix_list_2-4>li:before{content:"o  "}.lst-kix_list_2-5>li:before{content:"\0025aa   "}.lst-kix_list_2-8>li:before{content:"\0025aa   "}ul.lst-kix_list_2-8{list-style-type:none}ul.lst-kix_list_1-3{list-style-type:none}ul.lst-kix_list_2-2{list-style-type:none}.lst-kix_list_1-0>li:before{content:"-  "}ul.lst-kix_list_1-4{list-style-type:none}ul.lst-kix_list_2-3{list-style-type:none}ul.lst-kix_list_1-1{list-style-type:none}ul.lst-kix_list_2-0{list-style-type:none}ul.lst-kix_list_1-2{list-style-type:none}ul.lst-kix_list_2-1{list-style-type:none}ul.lst-kix_list_1-7{list-style-type:none}ul.lst-kix_list_2-6{list-style-type:none}.lst-kix_list_1-1>li:before{content:"o  "}.lst-kix_list_1-2>li:before{content:"\0025aa   "}ul.lst-kix_list_1-8{list-style-type:none}ul.lst-kix_list_2-7{list-style-type:none}ul.lst-kix_list_1-5{list-style-type:none}ul.lst-kix_list_2-4{list-style-type:none}ul.lst-kix_list_1-6{list-style-type:none}ul.lst-kix_list_2-5{list-style-type:none}.lst-kix_list_1-3>li:before{content:"\0025cf   "}.lst-kix_list_1-4>li:before{content:"o  "}.lst-kix_list_1-7>li:before{content:"o  "}.lst-kix_list_1-5>li:before{content:"\0025aa   "}.lst-kix_list_1-6>li:before{content:"\0025cf   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_list_2-0>li:before{content:"-  "}.lst-kix_list_2-1>li:before{content:"o  "}.lst-kix_list_1-8>li:before{content:"\0025aa   "}.lst-kix_list_2-2>li:before{content:"\0025aa   "}.lst-kix_list_2-3>li:before{content:"\0025cf   "}ol{margin:0;padding:0}table td,table th{padding:0}.c15{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:502.8pt;border-top-color:#000000;border-bottom-style:solid}.c27{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:503pt;border-top-color:#000000;border-bottom-style:solid}.c33{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:467.5pt;border-top-color:#000000;border-bottom-style:solid}.c32{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:510.1pt;border-top-color:#000000;border-bottom-style:solid}.c40{padding-top:12pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Calibri";font-style:normal}.c2{padding-top:2pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c0{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c37{padding-top:0pt;padding-bottom:12pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c30{padding-top:0pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c35{padding-top:0pt;padding-bottom:6pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c16{padding-top:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c14{padding-top:6pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c23{padding-top:12pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c39{padding-top:6pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c17{padding-top:0pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c12{padding-top:6pt;padding-bottom:6pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c31{padding-top:12pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c7{padding-top:6pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c34{font-weight:400;vertical-align:baseline;font-size:11pt;font-family:"Calibri";font-style:normal}.c5{font-size:9.5pt;font-family:"Consolas";color:#0000ff;font-weight:400}.c20{font-size:8pt;font-family:"Consolas";color:#a31515;font-weight:400}.c42{color:#2f5496;font-weight:400;font-size:16pt;font-family:"Calibri"}.c21{font-size:9.5pt;font-family:"Consolas";color:#a31515;font-weight:400}.c11{font-size:9.5pt;font-family:"Consolas";color:#2b91af;font-weight:400}.c22{font-size:8pt;font-family:"Consolas";color:#808080;font-weight:400}.c4{font-size:9.5pt;font-family:"Consolas";color:#000000;font-weight:400}.c28{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#0563c1;text-decoration:underline}.c18{color:#000000;font-weight:400;font-size:10pt;font-family:"Consolas"}.c10{border-spacing:0;border-collapse:collapse;margin-right:auto}.c9{color:#000000;font-weight:400;font-size:8pt;font-family:"Consolas"}.c25{color:#2f5496;font-weight:400;font-size:13pt;font-family:"Calibri"}.c19{font-size:8pt;font-family:"Consolas";color:#0000ff;font-weight:400}.c29{font-size:10pt;font-family:"Consolas";font-weight:400}.c6{text-decoration:none;vertical-align:baseline;font-style:normal}.c38{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c26{color:inherit;text-decoration:inherit}.c13{margin-left:54pt;padding-left:0pt}.c36{padding:0;margin:0}.c3{height:11pt}.c41{margin-right:-21.1pt}.c8{height:0pt}.c24{text-indent:36pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Calibri"}p{margin:0;color:#000000;font-size:11pt;font-family:"Calibri"}h1{padding-top:12pt;color:#2f5496;font-size:16pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:2pt;color:#2f5496;font-size:13pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:4pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c38 doc-content"><h1 class="c40"><span class="c6 c42">Mode Queue</span></h1><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Investigating which modes are running is a great way to learn a new P3 application. It is also crucial when debugging certain problems.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">In this TechTip, we show different approaches to trace what the ModeQueue is doing. In appendix, we show a trace of a complete 3-ball game of P3SampleApp.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The code presented is for debugging. You would likely remove it or comment it out when releasing the game.</span></p><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c25 c6">ModeQueue API</span></h2><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The ModeQueue is responsible for maintaining the list of currently running modes, sorted from highest to lowest priority. A higher number is a higher priority.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">We don&rsquo;t have direct access to the ModeQueue. Instead, we call the P3Controller which forwards the call to the private ModeQueue (inherited from MachineController):</span></p><p class="c0 c3"><span class="c1"></span></p><ul class="c36 lst-kix_list_2-0 start"><li class="c0 c13 li-bullet-0"><span class="c1">to start a mode, you call: p3.AddMode(myMode)</span></li><li class="c0 c13 li-bullet-0"><span class="c1">to stop a mode, you call: p3.RemoveMode(myMode)</span></li></ul><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Here, p3 is the P3Controller instance inherited by all P3Modes and myMode is the mode instance you want to start or stop.</span></p><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c25 c6">Visual Studio Debugger</span></h2><p class="c14"><span class="c1">One way to visualize the ModeQueue is to set a breakpoint in the debugger. </span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span>For detailed instructions how to set a breakpoint in your Unity script, refer to the TechTip: </span><span class="c28"><a class="c26" href="https://clempo2.github.io/P3TechTips/P3DevelopmentEnvironmentSetup.html">P3 Development Environment Setup</a></span><span class="c1">&nbsp;under the section &ldquo;Visual Studio Integration Walkthrough&rdquo;.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">When the breakpoint is hit, you can inspect your mode instance. In the Autos or Locals view, expand this.p3._modes.Modes, though to reach there, you will have to expand multiple base classes and Non-Public Members.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The following picture shows the variables in the P3SABaseGameMode constructor, with the ModeQueue highlighted near the bottom. At that time, the ModeQueue had 18 modes, though only the first 11 modes are visible in this picture.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 549.93px;"><img alt="" src="images/modeQueue/inspectModeQueue.png" style="width: 624.00px; height: 549.93px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c6 c25">LogModeClass</span></h2><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The ModeQueue has a built-in trace feature that can be configured programmatically. Again, this feature is accessed through the P3Controller which forwards the call to the ModeQueue.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">To instruct the ModeQueue to start tracing a specific modeClass, you call:</span></p><p class="c0 c24"><span class="c1">p3.LogModeClass(modeClass, true);</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The modeClass argument is a string. It would be perfectly reasonable to expect to call:</span></p><p class="c0 c24"><span class="c1">p3.LogModeClass(&quot;Multimorphic.P3SA.Modes.HomeMode&quot;, true);</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Unfortunately, that does not work. Instead, you have to call something like:</span></p><p class="c0 c24"><span class="c1">p3.LogModeClass(homeMode.ToString(), true);</span></p><p class="c0"><span class="c1">which is equivalent to</span></p><p class="c0"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p3.LogModeClass(&quot;HomeMode &nbsp; pri=20&quot;, true);</span></p><p class="c0"><span class="c1">Notice, if you don&rsquo;t have the mode instance available, you have to know the mode priority.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">After this call, the ModeQueue will log an event message whenever an instance of the modeClass is added or removed. These messages are at DEV exposure level, which is the default when running in the Unity Editor. See these lines in the P3SABaseGameMode constructor:</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c22">#if</span><span class="c9 c6">&nbsp;DEBUG</span></p><p class="c0"><span class="c6 c9">&nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.SetExposureLevel(Multimorphic.P3App.Logging.Logger.Exposure.Dev);</span></p><p class="c0"><span class="c22">#else</span></p><p class="c0"><span class="c22 c6">&nbsp; &nbsp; P3App.Logging.Logger.SetExposureLevel(P3App.Logging.Logger.Exposure.Public);</span></p><p class="c0"><span class="c22">#endif</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c1">To trace multiple modeClasses, you have to call LogModeClass() for each one:</span></p><p class="c0"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P3.LogModeClass(homeMode.ToString(), true);</span></p><p class="c0"><span class="c1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;P3.LogModeClass(attractMode.ToString(), true);</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c1">The messages appear at Info level in the console.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c37"><span class="c1">It might be easier to see all logs in a single file. You can access the full Editor Log by clicking the tiny menu icon in the top right corner of the Console view (just above the stop sign to select error messages).</span></p><p class="c0"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 454.87px;"><img alt="" src="images/modeQueue/consoleMenu.png" style="width: 624.00px; height: 454.87px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The log message itself is a one-line message followed by the stack trace where the mode was added or removed. Here is a log produced when HomeMode was added: </span></p><p class="c0 c3"><span class="c1"></span></p><a id="t.739074355dbddbc5e0a94298ac19af467a17c946"></a><a id="t.0"></a><table class="c10"><tr class="c8"><td class="c33" colspan="1" rowspan="1"><p class="c0"><span class="c1">20230609T22:01:23.409 : [DEV] Starting Mode: HomeMode &nbsp; pri=20 &nbsp; Priority:20</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">UnityEngine.DebugLogHandler:Internal_Log(LogType, String, Object)</span></p><p class="c0"><span class="c1">UnityEngine.DebugLogHandler:LogFormat(LogType, Object, String, Object[])</span></p><p class="c0"><span class="c1">UnityEngine.Logger:Log(LogType, Object)</span></p><p class="c0"><span class="c1">UnityEngine.Debug:Log(Object)</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Logging.Logger:Log(Exposure, LogCategory, String)</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Logging.Logger:Log(Exposure, String)</span></p><p class="c0"><span class="c1">Multimorphic.P3App.GUI.UnityLogger:Log(Exposure, String)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Logging.Logger:Log(Exposure, String)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Logging.Logger:LogEventMessage(String)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.ModeQueue:Add(Mode)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.MachineController:AddMode(Mode)</span></p><p class="c0"><span class="c1">Multimorphic.P3SA.Modes.P3SABaseGameMode:StartNewBall() (at Assets\Scripts\Modes\P3SABaseGameMode.cs:213)</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.BaseGameMode:GameIntro()</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.BaseGameMode:AddPlayerEventHandler(String, Object)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.EventManager:Post(String, Object)</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.P3Mode:PostModeEventToModes(String, Object)</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.GameManagerMode:AddPlayer()</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.GameManagerMode:StartGame()</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.GameManagerMode:PossiblyStartGameOrAddPlayer()</span></p><p class="c0"><span class="c1">Multimorphic.P3App.Modes.GameManagerMode:sw_start_inactive(Switch)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.Mode:handle_event(Event)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.ModeQueue:handle_event(Event)</span></p><p class="c0"><span class="c1">Multimorphic.P3.P3Controller:process_switch_event(Event, EventType)</span></p><p class="c0"><span class="c1">Multimorphic.P3.P3Controller:process_event(Event)</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.MachineController:process_events(Event[])</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.MachineController:run_loop_iteration()</span></p><p class="c0"><span class="c1">Multimorphic.P3.P3Controller:run_loop_iteration()</span></p><p class="c0"><span class="c1">Multimorphic.NetProcMachine.Machine.MachineController:run_loop()</span></p><p class="c0"><span class="c1">Multimorphic.P3App.GUI.P3ControllerInterface:HandleWorkerDoWork(Object, DoWorkEventArgs)</span></p><p class="c0"><span class="c1">System.ComponentModel.BackgroundWorker:OnDoWork(DoWorkEventArgs)</span></p><p class="c0"><span class="c1">System.ComponentModel.BackgroundWorker:ProcessWorker(Object, AsyncOperation, SendOrPostCallback)</span></p><p class="c0"><span class="c1">&nbsp;</span></p><p class="c0"><span class="c1">(Filename: Assets/Scripts/Modes/P3SABaseGameMode.cs Line: 213)</span></p></td></tr></table><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The log message when HomeMode is removed looks like this:</span></p><p class="c16"><span class="c1">20230609T22:04:54.284 : [DEV] Stopping Mode: HomeMode &nbsp; pri=20 &nbsp; Priority:20</span></p><p class="c30"><span class="c1">followed by the stack trace where the mode was removed.</span></p><p class="c0"><span class="c1">The LogModeClass feature of ModeQueue can be very useful to trace a few known modes, but as a general-purpose tracing facility, it can be hard to use.</span></p><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c25 c6">Using Reflection</span></h2><p class="c31"><span class="c1">Another approach is to programmatically look inside the ModeQueue on demand. Since the ModeQueue is private, we have to use Reflection to access it.</span></p><p class="c31"><span class="c1">We will use an event to trigger the log of the ModeQueue content.</span></p><p class="c16"><span class="c1">Add this line in the P3SABaseGameMode constructor:</span></p><a id="t.d3c4a716732dc58c994c9a87b3091fb22d5a0246"></a><a id="t.1"></a><table class="c10"><tr class="c8"><td class="c33" colspan="1" rowspan="1"><p class="c7"><span class="c4">AddModeEventHandler(&quot;Evt_LogModeQueue&quot;, LogModeQueueEventHandler, Priority);</span></p></td></tr></table><p class="c30 c3"><span class="c1"></span></p><p class="c30"><span class="c1">Add this method at the bottom of the P3SABaseGameMode class</span></p><a id="t.378d2d625c5c8a29a0d88cc2162842416c37922d"></a><a id="t.2"></a><table class="c10"><tr class="c8"><td class="c32" colspan="1" rowspan="1"><p class="c14"><span class="c19">public</span><span class="c9">&nbsp;</span><span class="c19">bool</span><span class="c9">&nbsp;LogModeQueueEventHandler(</span><span class="c19">string</span><span class="c9">&nbsp;eventName, </span><span class="c19">object</span><span class="c9 c6">&nbsp;eventData)</span></p><p class="c0"><span class="c9 c6">{</span></p><p class="c0"><span class="c9">&nbsp; &nbsp; ModeQueue queue = (ModeQueue)</span><span class="c19">typeof</span><span class="c9">(P3Controller).GetField(</span><span class="c20">&quot;_modes&quot;</span><span class="c9 c6">, System.Reflection.BindingFlags.NonPublic | System.Reflection.BindingFlags.Instance).GetValue(p3);</span></p><p class="c0"><span class="c9">&nbsp; &nbsp; System.Text.StringBuilder sb = </span><span class="c19">new</span><span class="c9 c6">&nbsp;System.Text.StringBuilder();</span></p><p class="c0"><span class="c9">&nbsp; &nbsp; sb.AppendLine(</span><span class="c20">&quot;===== ModeQueue:&quot;</span><span class="c9 c6">);</span></p><p class="c0"><span class="c9">&nbsp; &nbsp; </span><span class="c19">foreach</span><span class="c9">&nbsp;(Mode mode </span><span class="c19">in</span><span class="c9 c6">&nbsp;queue.Modes)</span></p><p class="c0"><span class="c9 c6">&nbsp; &nbsp; {</span></p><p class="c0"><span class="c9">&nbsp; &nbsp; &nbsp; &nbsp; sb.AppendLine(</span><span class="c20">&quot; &nbsp; &nbsp;&quot;</span><span class="c9 c6">&nbsp;+ mode.ToString());</span></p><p class="c0"><span class="c9 c6">&nbsp; &nbsp; }</span></p><p class="c0"><span class="c9 c6">&nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.LogError(Multimorphic.P3App.Logging.LogCategories.Game, sb.ToString());</span></p><p class="c0 c3"><span class="c9 c6"></span></p><p class="c0"><span class="c9">&nbsp; &nbsp; </span><span class="c19">return</span><span class="c9 c6">&nbsp;EVENT_CONTINUE;</span></p><p class="c17"><span class="c9 c6">}</span></p></td></tr></table><p class="c23"><span class="c1">We are logging at Error level to make it easier to see the traces, but these are obviously not errors.</span></p><p class="c23"><span class="c1">Edit P3SampleApp\Configuration\AppConfig.json</span></p><p class="c35"><span class="c1">Replace the line</span></p><a id="t.34d85da3cc9fc069b306612d0021918199694b43"></a><a id="t.3"></a><table class="c10"><tr class="c8"><td class="c33" colspan="1" rowspan="1"><p class="c7"><span class="c18 c6">&nbsp; &nbsp; {&quot;Key&quot;:&quot;Alpha4&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Switch&quot;:&quot;money3&quot;}</span></p></td></tr></table><p class="c12"><span class="c1">With</span></p><a id="t.f3de42b058a4f9a58ecd9bbcae30de665ef57f47"></a><a id="t.4"></a><table class="c10"><tr class="c8"><td class="c33" colspan="1" rowspan="1"><p class="c14"><span class="c6 c18">&nbsp; &nbsp; {&quot;Key&quot;:&quot;Alpha4&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;Switch&quot;:&quot;money3&quot;},</span></p><p class="c17"><span class="c18 c6">&nbsp; &nbsp; {&quot;Key&quot;:&quot;F1&quot;, &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&quot;ModeToModeEvent&quot;:&quot;Evt_LogModeQueue&quot;, &quot;Data&quot;:&quot;&quot;}</span></p></td></tr></table><p class="c39"><span class="c1">Start the application by clicking the play icon in the Unity Editor. When the application is started, hit the F1 function key, this will log the content of the ModeQueue.</span></p><p class="c30"><span class="c1">Right now, the only way to generate the Evt_LogModeQueue event is to hit the F1 key, so this only works in the simulator in the Unity Editor.</span></p><p class="c30"><span class="c1">It will also work in the real machine if you add code in your application to post the event when some predetermined condition happens:</span></p><p class="c30 c24"><span>PostModeEventToModes(&quot;</span><span class="c29">Evt_LogModeQueue</span><span class="c1">&nbsp;&quot;, null);</span></p><p class="c0"><span class="c1">Here is a sample log message showing the contents of the ModeQueue during AttractMode:</span></p><p class="c0 c3"><span class="c1"></span></p><a id="t.96be28476950ea73e2a2aec388419914dcd96c59"></a><a id="t.5"></a><table class="c10"><tr class="c8"><td class="c33" colspan="1" rowspan="1"><p class="c14"><span class="c1">20230610T00:00:16.618 : &lt;b&gt;&lt;color=Green&gt;[Game] &lt;/color&gt;&lt;/b&gt;===== ModeQueue:</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AppExitMode &nbsp; pri=54010</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; CoinDoorMode &nbsp; pri=53010</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; TeamGameManagerMode &nbsp; pri=52111</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; ProfileManagerMode &nbsp; pri=52110</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; SelectorManagerMode &nbsp; pri=52010</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SAButtonCombosMode &nbsp; pri=50009</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; Drain &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; TroughLauncher &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; TroughLauncher &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; TroughLauncher &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; Underkeeper &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; LEDControllerMode &nbsp; pri=777</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; GUIInsertControllerMode &nbsp; pri=777</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; BackboxColorsMode &nbsp; pri=410</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; BluetoothManagerMode &nbsp; pri=315</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; PlayfieldModuleManager &nbsp; pri=285</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MoneyMode &nbsp; pri=211</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; GameManagerMode &nbsp; pri=210</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; HighScoresUpdateManagerMode &nbsp; pri=187</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SAHighScoresMode &nbsp; pri=185</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; HoleMode &nbsp; pri=170</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; HoleMode &nbsp; pri=170</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; HoleMode &nbsp; pri=170</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; BallSearchMode &nbsp; pri=165</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MagnetMode &nbsp; pri=164</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MagnetVUKMode &nbsp; pri=163</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; ShotsMode &nbsp; pri=162</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; PauseBallLauncherMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MagnetRingMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MagnetRingMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; MagnetRingMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; OuterLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; TicketDispenseMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RightRampControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; ModuleController &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; PopupMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; ShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; BallLauncherMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; InnerLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; LevelMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; PlayfieldControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; OuterLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; CCRDevice &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RightLoopControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; InnerLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; HUDMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RGBFadeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SAAttractMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; LEDShowControllerMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; FlippersMode &nbsp; pri=12</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SAEventProfileManagerMode &nbsp; pri=3</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AchievementsManagerMode &nbsp; pri=3</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; GridInterfaceMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; PlayfieldModuleLocalSettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; LEDSimulatorMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; LogMarkerMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SASettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; BaseGUIInserts &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; GlobalSettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SAGameAttributeManagerMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SABaseGameMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; PlayfieldModuleSettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; P3SAStatisticsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; Playfield &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallsScoops &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p><p class="c17"><span class="c1">&nbsp; &nbsp; WallScoop &nbsp; pri=1</span></p></td></tr></table><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c25 c6">Patching P3Controller</span></h2><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Our goal is to add a trace message at the beginning of the AddMode() and RemoveMode() methods to log the trace immediately. We want to do this for every mode without configuration.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">The AddMode() and RemoveMode() methods are non-virtual. There is no point in subclassing the P3Controller to try to override these methods.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Reflection makes it easy to retrieve the implementation of a method as a delegate, but there is no easy way to replace the implementation with another delegate (at least in .NET 3.5)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span>Enter </span><span class="c28"><a class="c26" href="https://github.com/pardeike/Harmony">Harmony</a></span><span class="c1">. &nbsp;Harmony is a library for patching, replacing and decorating .NET and Mono methods during runtime. It handles all the low-level, version specific, non-portable code and exposes a very easy API based on code Attributes.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">To install Harmony:</span></p><ul class="c36 lst-kix_list_2-0"><li class="c0 c13 c41 li-bullet-0"><span class="c1">Download the pre-compiled library from </span><span class="c34 c28"><a class="c26" href="https://github.com/pardeike/Harmony/releases">GitHub</a></span><span class="c1">. For this tech tip, I downloaded </span><span class="c28 c34"><a class="c26" href="https://github.com/pardeike/Harmony/releases/download/v2.2.2.0/Harmony.2.2.2.0.zip">version 2.2.2.0</a></span></li><li class="c0 c13 li-bullet-0"><span class="c1">Extract the Harmony.2.2.2.0.zip somewhere.</span></li><li class="c0 c13 li-bullet-0"><span class="c1">Copy Harmony.2.2.2.0\net35\0Harmony.dll to P3SampleApp\Assets\Plugins\0Harmony.dll</span></li></ul><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Edit P3SampleApp\Assets\Scripts\P3SABaseGameMode.cs as follows.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Add this import statement:</span></p><a id="t.c8e3a69c8d407691d4725cca727e5216cb18e451"></a><a id="t.6"></a><table class="c10"><tr class="c8"><td class="c27" colspan="1" rowspan="1"><p class="c7"><span class="c5">using</span><span class="c4 c6">&nbsp;HarmonyLib;</span></p></td></tr></table><p class="c0 c3"><span class="c1"></span></p><p class="c16"><span class="c1">Add this class immediately below the namespace statement:</span></p><a id="t.cb6e5f4b070d0012ccdf6636cf3a1b5472449aa8"></a><a id="t.7"></a><table class="c10"><tr class="c8"><td class="c27" colspan="1" rowspan="1"><p class="c14"><span class="c4">&nbsp; &nbsp; </span><span class="c5">public</span><span class="c4">&nbsp;</span><span class="c5">class</span><span class="c4">&nbsp;</span><span class="c11">MachineControllerPatches</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; [HarmonyPatch(</span><span class="c5">typeof</span><span class="c4">(MachineController), </span><span class="c21">&quot;AddMode&quot;</span><span class="c4 c6">)]</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; [HarmonyPrefix]</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4 c6">&nbsp;AddModePrefix(Mode mode)</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.LogError(</span><span class="c21">&quot;AddMode &quot;</span><span class="c4 c6">&nbsp;+ mode.ToString());</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; [HarmonyPatch(</span><span class="c5">typeof</span><span class="c4">(MachineController), </span><span class="c21">&quot;RemoveMode&quot;</span><span class="c4 c6">)]</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; [HarmonyPrefix]</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4 c6">&nbsp;RemoveModePrefix(Mode mode)</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.LogError(</span><span class="c21">&quot;RemoveMode &quot;</span><span class="c4 c6">&nbsp;+ mode.ToString());</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c17"><span class="c4 c6">&nbsp; &nbsp; }</span></p></td></tr></table><p class="c30 c3"><span class="c4 c6"></span></p><p class="c16"><span class="c1">Add this static member declaration before the P3SABaseGameMode constructor:</span></p><a id="t.0cc56540363922c7427b2b4e2f77829db0eef6e3"></a><a id="t.8"></a><table class="c10"><tr class="c8"><td class="c15" colspan="1" rowspan="1"><p class="c16"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp;private&nbsp;static&nbsp;Harmony harmony;</span></p></td></tr></table><p class="c16 c3"><span class="c1"></span></p><p class="c16"><span class="c1">Add these statements in the P3SABaseGameMode constructor:</span></p><a id="t.5d2a7a531e8d670bc9631bf5f2c8796076b4570d"></a><a id="t.9"></a><table class="c10"><tr class="c8"><td class="c27" colspan="1" rowspan="1"><p class="c14" id="h.gjdgxs"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; harmony = </span><span class="c5">new</span><span class="c4">&nbsp;Harmony(</span><span class="c21">&quot;com.example.patch&quot;</span><span class="c4 c6">);</span></p><p class="c17"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; harmony.PatchAll();</span></p></td></tr></table><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Again, we are logging at Error level to make it easier to see the traces, but these are not errors. Feel free to change the log level.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">Run the Unity project. The log will show the AddMode and RemoveMode traces for all modes.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">We chose to implement the method patches in the P3SABaseGameMode constructor because that&rsquo;s the first application specific code that is executed (except maybe P3SASetup).</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c37"><span class="c1">There is a small problem. When the P3SABaseGameMode constructor is called, the ModeQueue already contains some modes. You can get a list of those modes by calling the event handler from the previous section right after the methods are patched:</span></p><a id="t.c9ee4e1b8379b87728bef434526e9464de32cf2b"></a><a id="t.10"></a><table class="c10"><tr class="c8"><td class="c27" colspan="1" rowspan="1"><p class="c14"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; harmony = </span><span class="c5">new</span><span class="c4">&nbsp;Harmony(</span><span class="c21">&quot;com.example.patch&quot;</span><span class="c4 c6">);</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; harmony.PatchAll();</span></p><p class="c17"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; LogModeQueueEventHandler(null, null);</span></p></td></tr></table><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c25 c6">Patching P3Controller Part 2</span></h2><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">It is typical for a mode to add more modes when it is started. Similarly, it is typical for a mode to remove other modes when it is removed. Let&rsquo;s see how we can capture this relationship in our traces.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">When AddMode() is called, the mode_started() method is called before AddMode() returns. Imagine we increased the indent level when we enter AddMode() and we reverted the indent level back after AddMode() but before we fully returned. Similarly for RemoveMode(). The submodes now show up indented one more level compared to their parent.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">We need to inject code at the start of the method with a Prefix method, and at the end of the method with a Postfix method. We could have all Prefix and Postfix methods in the same class, but it is cleaner to separate them into two classes, one per method.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c17"><span class="c1">Replace the MachineControllerPatches class from the previous section with this implementation:</span></p><a id="t.56352be1a3aec59c1c1944b44cba274a2a9e0364"></a><a id="t.11"></a><table class="c10"><tr class="c8"><td class="c33" colspan="1" rowspan="1"><p class="c14"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c5">public</span><span class="c4">&nbsp;</span><span class="c5">class</span><span class="c4">&nbsp;</span><span class="c11">MachineControllerPatches</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">public</span><span class="c4">&nbsp;</span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">int</span><span class="c4 c6">&nbsp;indent = 0;</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">public</span><span class="c4">&nbsp;</span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4">&nbsp;TraceMethod(</span><span class="c5">string</span><span class="c4 c6">&nbsp;method, Mode mode)</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">string</span><span class="c4">&nbsp;spaces = </span><span class="c5">new</span><span class="c4">&nbsp;</span><span class="c5">string</span><span class="c4">(</span><span class="c21">&#39; &#39;</span><span class="c4 c6">, indent);</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.LogError(</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c21">&quot;=====&quot;</span><span class="c4">&nbsp;+ spaces + method + </span><span class="c21">&quot; &quot;</span><span class="c4 c6">&nbsp;+ mode.ToString());</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [HarmonyPatch(</span><span class="c5">typeof</span><span class="c4">(MachineController), </span><span class="c21">&quot;AddMode&quot;</span><span class="c4 c6">)]</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">public</span><span class="c4">&nbsp;</span><span class="c5">class</span><span class="c4">&nbsp;</span><span class="c11">AddModePatch</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4 c6">&nbsp;Prefix(Mode mode)</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TraceMethod(</span><span class="c21">&quot;AddMode&quot;</span><span class="c4 c6">, mode);</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; indent += 4;</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4 c6">&nbsp;Postfix()</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; indent -= 4;</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [HarmonyPatch(</span><span class="c5">typeof</span><span class="c4">(MachineController), </span><span class="c21">&quot;RemoveMode&quot;</span><span class="c4 c6">)]</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">public</span><span class="c4">&nbsp;</span><span class="c5">class</span><span class="c4">&nbsp;</span><span class="c11">RemoveModePatch</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4 c6">&nbsp;Prefix(Mode mode)</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; TraceMethod(</span><span class="c21">&quot;RemoveMode&quot;</span><span class="c4 c6">, mode);</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; indent += 4;</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0 c3"><span class="c4 c6"></span></p><p class="c0"><span class="c4">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">static</span><span class="c4">&nbsp;</span><span class="c5">void</span><span class="c4 c6">&nbsp;Postfix()</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; indent -= 4;</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c0"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c17"><span class="c4 c6">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p></td></tr></table><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">See the appendix for a sample output.</span></p><p class="c0 c3"><span class="c1"></span></p><h2 class="c2"><span class="c25 c6">Appendix: Complete P3SampleApp Trace</span></h2><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">This trace shows all the modes that were added and removed during a complete 3-ball game of P3SampleApp. The indent level indicates the relationship between a parent mode and its submodes. Some modes appear simultaneously multiple times in the ModeQueue. Those are different instances of the same mode class. The stack traces have been omitted for brevity. A few comments were added for clarity.</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">// Startup + AttractMode</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">AddMode P3SABaseGameMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode P3SAGameAttributeManagerMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode P3SASettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode GlobalSettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode PlayfieldModuleSettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode PlayfieldModuleLocalSettingsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode P3SAHighScoresMode &nbsp; pri=185</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode P3SAStatisticsMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode P3SAEventProfileManagerMode &nbsp; pri=3</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode AchievementsManagerMode &nbsp; pri=3</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode HighScoresUpdateManagerMode &nbsp; pri=187</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode ProfileManagerMode &nbsp; pri=52110</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode TeamGameManagerMode &nbsp; pri=52111</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode BluetoothManagerMode &nbsp; pri=315</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode AppExitMode &nbsp; pri=54010</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode LEDSimulatorMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode GridInterfaceMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode LevelMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode BaseGUIInserts &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode GUIInsertControllerMode &nbsp; pri=777</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode BackboxColorsMode &nbsp; pri=410</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode BallLauncherMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode PauseBallLauncherMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode SelectorManagerMode &nbsp; pri=52010</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode CoinDoorMode &nbsp; pri=53010</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode Underkeeper &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MiniTrough &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode Drain &nbsp; pri=1000</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode BallSearchMode &nbsp; pri=165</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode GameManagerMode &nbsp; pri=210</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode MoneyMode &nbsp; pri=211</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode LogMarkerMode &nbsp; pri=2</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode PlayfieldModuleManager &nbsp; pri=285</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddMode ModuleController &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode CCRDevice &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode PlayfieldControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode HoleMode &nbsp; pri=170</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode HoleMode &nbsp; pri=170</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode HoleMode &nbsp; pri=170</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode MagnetVUKMode &nbsp; pri=163</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode MagnetMode &nbsp; pri=164</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode RightRampControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode MagnetRingMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode MagnetRingMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode MagnetRingMode &nbsp; pri=161</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode ShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode RightLoopControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode InnerLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode InnerLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode OuterLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddMode OuterLoopShotControllerMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode FlippersMode &nbsp; pri=12</span></p><p class="c0"><span class="c1">AddMode P3SAAttractMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode TicketDispenseMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">AddMode P3SAButtonCombosMode &nbsp; pri=50009</span></p><p class="c0"><span class="c1">AddMode ShotsMode &nbsp; pri=162</span></p><p class="c0"><span class="c1">AddMode HUDMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">AddMode PopupMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">AddMode LEDShowControllerMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode RGBFadeMode &nbsp; pri=20</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">// Ball 1</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">AddMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">AddMode HomeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">RemoveMode P3SAAttractMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode LEDShowControllerMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; RemoveMode RGBFadeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode BallSaveMode &nbsp; pri=75</span></p><p class="c0"><span class="c1">AddMode RespawnMode &nbsp; pri=74</span></p><p class="c0"><span class="c1">AddMode MovingTargetMode &nbsp; pri=80</span></p><p class="c0"><span class="c1">AddMode SideTargetMode &nbsp; pri=42</span></p><p class="c0"><span class="c1">AddMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode LanesMode &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode TwitchControlMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode BallStartMode &nbsp; pri=22</span></p><p class="c0"><span class="c1">AddMode StageBallOnRampMode &nbsp; pri=180</span></p><p class="c0"><span class="c1">RemoveMode StageBallOnRampMode &nbsp; pri=180</span></p><p class="c0"><span class="c1">AddMode BonusMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">RemoveMode HomeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode BallSaveMode &nbsp; pri=75</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode RespawnMode &nbsp; pri=74</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode MovingTargetMode &nbsp; pri=80</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode SideTargetMode &nbsp; pri=42</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode LanesMode &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode TwitchControlMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode BallStartMode &nbsp; pri=22</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode RGBRandomFlashMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode InstructionMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">RemoveMode BonusMode &nbsp; pri=160</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">// Ball 2</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">AddMode NextBallMode &nbsp; pri=11</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode NextBallMode &nbsp; pri=11</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode HomeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode BallSaveMode &nbsp; pri=75</span></p><p class="c0"><span class="c1">AddMode RespawnMode &nbsp; pri=74</span></p><p class="c0"><span class="c1">AddMode MovingTargetMode &nbsp; pri=80</span></p><p class="c0"><span class="c1">AddMode SideTargetMode &nbsp; pri=42</span></p><p class="c0"><span class="c1">AddMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode LanesMode &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode TwitchControlMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode BallStartMode &nbsp; pri=22</span></p><p class="c0"><span class="c1">AddMode StageBallOnRampMode &nbsp; pri=180</span></p><p class="c0"><span class="c1">RemoveMode StageBallOnRampMode &nbsp; pri=180</span></p><p class="c0"><span class="c1">AddMode BonusMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">RemoveMode HomeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode BallSaveMode &nbsp; pri=75</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode RespawnMode &nbsp; pri=74</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode MovingTargetMode &nbsp; pri=80</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode SideTargetMode &nbsp; pri=42</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode LanesMode &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode TwitchControlMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode BallStartMode &nbsp; pri=22</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode RGBRandomFlashMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode InstructionMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">RemoveMode BonusMode &nbsp; pri=160</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">// Ball 3</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">AddMode NextBallMode &nbsp; pri=11</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode NextBallMode &nbsp; pri=11</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode HomeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode BallSaveMode &nbsp; pri=75</span></p><p class="c0"><span class="c1">AddMode RespawnMode &nbsp; pri=74</span></p><p class="c0"><span class="c1">AddMode MovingTargetMode &nbsp; pri=80</span></p><p class="c0"><span class="c1">AddMode SideTargetMode &nbsp; pri=42</span></p><p class="c0"><span class="c1">AddMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode LanesMode &nbsp; pri=70</span></p><p class="c0"><span class="c1">AddMode TwitchControlMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">AddMode BallStartMode &nbsp; pri=22</span></p><p class="c0"><span class="c1">AddMode StageBallOnRampMode &nbsp; pri=180</span></p><p class="c0"><span class="c1">RemoveMode StageBallOnRampMode &nbsp; pri=180</span></p><p class="c0"><span class="c1">AddMode BonusMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">RemoveMode HomeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode BallSaveMode &nbsp; pri=75</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode RespawnMode &nbsp; pri=74</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode MovingTargetMode &nbsp; pri=80</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode SideTargetMode &nbsp; pri=42</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode LanesMode &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode ShotCounter &nbsp; pri=70</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode TwitchControlMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode BallStartMode &nbsp; pri=22</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode RGBRandomFlashMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode InstructionMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">RemoveMode BonusMode &nbsp; pri=160</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">// High Score Entry</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">AddMode NextBallMode &nbsp; pri=11</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; RemoveMode NextBallMode &nbsp; pri=11</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode HighScoreNameSelectorMode &nbsp; pri=50135</span></p><p class="c0"><span class="c1">RemoveMode HighScoreNameSelectorMode &nbsp; pri=50135</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">// AttractMode</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">AddMode P3SAAttractMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">RemoveMode TiltMode &nbsp; pri=160</span></p><p class="c0"><span class="c1">AddMode LEDShowControllerMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">&nbsp; &nbsp; AddMode RGBFadeMode &nbsp; pri=20</span></p><p class="c0"><span class="c1">RemoveMode ResultsMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">AddMode ResultsMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">RemoveMode ResultsMode &nbsp; pri=21</span></p><p class="c0"><span class="c1">RemoveMode HighScoreResultsMode &nbsp; pri=188</span></p><p class="c0"><span class="c1">AddMode HighScoreResultsMode &nbsp; pri=188</span></p></body></html>
