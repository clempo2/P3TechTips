<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=fpjTOVmNbO4Lz34iLyptLROjXfSpIU_1TsQlCJ7q4WlXEixY9aqhie8CVYCrTb1E);.lst-kix_list_2-6>li:before{content:"" counter(lst-ctn-kix_list_2-6,decimal) ". "}.lst-kix_list_2-7>li:before{content:"" counter(lst-ctn-kix_list_2-7,decimal) ". "}.lst-kix_list_2-7>li{counter-increment:lst-ctn-kix_list_2-7}.lst-kix_list_2-1>li{counter-increment:lst-ctn-kix_list_2-1}ul.lst-kix_list_1-0{list-style-type:none}.lst-kix_list_2-4>li:before{content:"" counter(lst-ctn-kix_list_2-4,decimal) ". "}.lst-kix_list_2-5>li:before{content:"" counter(lst-ctn-kix_list_2-5,decimal) ". "}.lst-kix_list_2-8>li:before{content:"" counter(lst-ctn-kix_list_2-8,decimal) ". "}ol.lst-kix_list_2-6.start{counter-reset:lst-ctn-kix_list_2-6 0}.lst-kix_list_3-0>li:before{content:"-  "}.lst-kix_list_3-1>li:before{content:"\0025cf   "}.lst-kix_list_3-2>li:before{content:"\0025aa   "}ul.lst-kix_list_3-7{list-style-type:none}ul.lst-kix_list_3-8{list-style-type:none}ol.lst-kix_list_2-3.start{counter-reset:lst-ctn-kix_list_2-3 0}ul.lst-kix_list_1-3{list-style-type:none}ul.lst-kix_list_3-1{list-style-type:none}.lst-kix_list_3-5>li:before{content:"\0025aa   "}ul.lst-kix_list_1-4{list-style-type:none}ul.lst-kix_list_3-2{list-style-type:none}ul.lst-kix_list_1-1{list-style-type:none}.lst-kix_list_3-4>li:before{content:"o  "}ul.lst-kix_list_1-2{list-style-type:none}ul.lst-kix_list_3-0{list-style-type:none}ul.lst-kix_list_1-7{list-style-type:none}.lst-kix_list_3-3>li:before{content:"\0025cf   "}ul.lst-kix_list_3-5{list-style-type:none}ul.lst-kix_list_1-8{list-style-type:none}ul.lst-kix_list_3-6{list-style-type:none}ul.lst-kix_list_1-5{list-style-type:none}ul.lst-kix_list_3-3{list-style-type:none}ul.lst-kix_list_1-6{list-style-type:none}ul.lst-kix_list_3-4{list-style-type:none}ol.lst-kix_list_2-5.start{counter-reset:lst-ctn-kix_list_2-5 0}.lst-kix_list_3-8>li:before{content:"\0025aa   "}.lst-kix_list_2-0>li{counter-increment:lst-ctn-kix_list_2-0}.lst-kix_list_4-0>li:before{content:"-  "}.lst-kix_list_2-3>li{counter-increment:lst-ctn-kix_list_2-3}.lst-kix_list_2-6>li{counter-increment:lst-ctn-kix_list_2-6}.lst-kix_list_4-1>li:before{content:"o  "}.lst-kix_list_3-6>li:before{content:"\0025cf   "}.lst-kix_list_3-7>li:before{content:"o  "}.lst-kix_list_4-4>li:before{content:"o  "}ol.lst-kix_list_2-2.start{counter-reset:lst-ctn-kix_list_2-2 0}.lst-kix_list_4-3>li:before{content:"\0025cf   "}.lst-kix_list_4-5>li:before{content:"\0025aa   "}.lst-kix_list_4-2>li:before{content:"\0025aa   "}.lst-kix_list_4-6>li:before{content:"\0025cf   "}ol.lst-kix_list_2-2{list-style-type:none}ol.lst-kix_list_2-3{list-style-type:none}ol.lst-kix_list_2-4{list-style-type:none}ol.lst-kix_list_2-5{list-style-type:none}ol.lst-kix_list_2-0{list-style-type:none}.lst-kix_list_2-4>li{counter-increment:lst-ctn-kix_list_2-4}ol.lst-kix_list_2-1{list-style-type:none}.lst-kix_list_4-8>li:before{content:"\0025aa   "}.lst-kix_list_4-7>li:before{content:"o  "}ul.lst-kix_list_4-8{list-style-type:none}ul.lst-kix_list_4-6{list-style-type:none}ul.lst-kix_list_4-7{list-style-type:none}ol.lst-kix_list_2-8.start{counter-reset:lst-ctn-kix_list_2-8 0}ul.lst-kix_list_4-0{list-style-type:none}ul.lst-kix_list_4-1{list-style-type:none}.lst-kix_list_1-0>li:before{content:"-  "}ul.lst-kix_list_4-4{list-style-type:none}ol.lst-kix_list_2-6{list-style-type:none}ul.lst-kix_list_4-5{list-style-type:none}.lst-kix_list_1-1>li:before{content:"o  "}.lst-kix_list_1-2>li:before{content:"\0025aa   "}ol.lst-kix_list_2-0.start{counter-reset:lst-ctn-kix_list_2-0 0}ol.lst-kix_list_2-7{list-style-type:none}ul.lst-kix_list_4-2{list-style-type:none}ol.lst-kix_list_2-8{list-style-type:none}ul.lst-kix_list_4-3{list-style-type:none}.lst-kix_list_1-3>li:before{content:"\0025cf   "}.lst-kix_list_1-4>li:before{content:"o  "}.lst-kix_list_1-7>li:before{content:"o  "}ol.lst-kix_list_2-7.start{counter-reset:lst-ctn-kix_list_2-7 0}.lst-kix_list_1-5>li:before{content:"\0025aa   "}.lst-kix_list_1-6>li:before{content:"\0025cf   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_list_2-0>li:before{content:"" counter(lst-ctn-kix_list_2-0,decimal) ". "}.lst-kix_list_2-1>li:before{content:"" counter(lst-ctn-kix_list_2-1,decimal) ". "}ol.lst-kix_list_2-1.start{counter-reset:lst-ctn-kix_list_2-1 0}.lst-kix_list_2-5>li{counter-increment:lst-ctn-kix_list_2-5}.lst-kix_list_2-8>li{counter-increment:lst-ctn-kix_list_2-8}.lst-kix_list_1-8>li:before{content:"\0025aa   "}.lst-kix_list_2-2>li:before{content:"" counter(lst-ctn-kix_list_2-2,decimal) ". "}.lst-kix_list_2-3>li:before{content:"" counter(lst-ctn-kix_list_2-3,decimal) ". "}.lst-kix_list_2-2>li{counter-increment:lst-ctn-kix_list_2-2}ol.lst-kix_list_2-4.start{counter-reset:lst-ctn-kix_list_2-4 0}ol{margin:0;padding:0}table td,table th{padding:0}.c15{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:719.5pt;border-top-color:#000000;border-bottom-style:solid}.c0{margin-left:36pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c4{margin-left:72pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c19{padding-top:2pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c34{padding-top:12pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9.5pt;font-family:"Consolas";font-style:normal}.c8{padding-top:2pt;padding-bottom:12pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c23{padding-top:12pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c20{padding-top:0pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c17{padding-top:12pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c11{padding-top:0pt;padding-bottom:8pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c33{padding-top:0pt;padding-bottom:6pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c25{padding-top:0pt;padding-bottom:0pt;line-height:1.0791666666666666;orphans:2;widows:2;text-align:left}.c16{padding-top:6pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c14{padding-top:6pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c5{padding-top:12pt;padding-bottom:12pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c7{font-size:8pt;font-family:"Consolas";color:#000000;font-weight:400}.c27{font-size:8pt;font-family:"Consolas";color:#a31515;font-weight:400}.c29{color:#008000;font-weight:400;font-size:9.5pt;font-family:"Consolas"}.c22{font-size:9.5pt;font-family:"Consolas";color:#2b91af;font-weight:400}.c18{font-size:9.5pt;font-family:"Consolas";color:#0000ff;font-weight:400}.c35{color:#2f5496;font-weight:400;font-size:16pt;font-family:"Calibri"}.c13{color:#000000;font-weight:400;font-size:11pt;font-family:"Calibri"}.c10{font-size:9.5pt;font-family:"Consolas";color:#a31515;font-weight:400}.c1{font-size:8pt;font-family:"Consolas";color:#0000ff;font-weight:400}.c3{font-size:9.5pt;font-family:"Consolas";color:#000000;font-weight:400}.c24{color:#2f5496;font-weight:400;font-size:13pt;font-family:"Calibri"}.c26{border-spacing:0;border-collapse:collapse;margin-right:auto}.c9{text-decoration:none;vertical-align:baseline;font-style:normal}.c28{background-color:#ffffff;max-width:720pt;padding:36pt 36pt 36pt 36pt}.c21{padding:0;margin:0}.c32{margin-left:72pt;padding-left:0pt}.c12{margin-left:36pt;padding-left:0pt}.c31{height:11pt}.c30{height:0pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Calibri"}p{margin:0;color:#000000;font-size:11pt;font-family:"Calibri"}h1{padding-top:12pt;color:#2f5496;font-size:16pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:2pt;color:#2f5496;font-size:13pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:0pt;color:#000000;font-weight:700;font-size:13.5pt;padding-bottom:8pt;font-family:"Times New Roman";line-height:1.0;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c28 doc-content"><h1 class="c34"><span class="c9 c35">Declaring GameAttributes</span></h1><p class="c11 c31"><span class="c13 c9"></span></p><p class="c11"><span class="c13 c9">GameAttributes store persistent data like settings, stats and high scores. They are documented in P3_SDK_V0.8\P3SampleApp\Documentation\html\ _persistent_data.html</span></p><p class="c11"><span class="c13 c9">This article concentrates on settings. The discussion does not directly apply to stats or high scores. High scores have their own API.</span></p><h2 class="c8"><span class="c24 c9">Database Version</span></h2><p class="c33"><span class="c13 c9">In P3SampleApp, the game settings are defined in Assets\Scripts\Modes\DataManagement\P3SASettingsMode.cs in the method CreateDefaultAttrs(). </span></p><p class="c11"><span class="c13 c9">For example, here is how the BallSaveTime GameAttribute is defined:</span></p><a id="t.80b1b0cb1fbb57e2d789b54505586fab8c714689"></a><a id="t.0"></a><table class="c26"><tr class="c30"><td class="c15" colspan="1" rowspan="1"><p class="c14" id="h.gjdgxs"><span class="c7">InitAttr(37, </span><span class="c27">&quot;BallSaveTime&quot;</span><span class="c7">, </span><span class="c27">&quot;Ball Save Time&quot;</span><span class="c7">, </span><span class="c27">&quot;Ball Save Time&quot;</span><span class="c7">, </span><span class="c27">&quot;Service Menu/Settings/Gameplay/General&quot;</span><span class="c7">, PRW, 15, 0, 20, 1, 15);</span></p></td></tr></table><p class="c17"><span class="c13 c9">P3SASettingsMode stores its GameAttributes in the database at &lt;UserHome&gt;\.multimorphic\P3\Data\&lt;AppCode&gt;\settings.db</span></p><p class="c17"><span class="c13 c9">When P3SASettingsMode is created, it compares its own version against the version stored in the database. If the versions are the same, the persisted data is used. If the database version is older, the persisted data is dropped and the database is recreated with the new GameAttribute definitions.</span></p><p class="c17"><span class="c13 c9">The P3SASettingsMode version is specified in the constructor:</span></p><a id="t.3360c6158244334aaa04b10c7c43f6defd73ffe4"></a><a id="t.1"></a><table class="c26"><tr class="c30"><td class="c15" colspan="1" rowspan="1"><p class="c23"><span class="c7 c9">public P3SASettingsMode (P3Controller controller, int priority)</span></p><p class="c6"><span class="c7 c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: base(controller, priority)</span></p><p class="c6"><span class="c7 c9">{</span></p><p class="c6"><span class="c7 c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataVersion = 41;</span></p><p class="c6"><span class="c7 c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DBVersion = 28;</span></p><p class="c6"><span class="c7 c9">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// more code not shown...</span></p><p class="c20"><span class="c7">}</span></p></td></tr></table><p class="c11 c31"><span class="c7 c9"></span></p><p class="c25"><span class="c13 c9">The documentation for P3SASettingsMode can be found in </span></p><p class="c25"><span class="c13 c9">P3_SDK_V0.8/P3SampleApp/Documentation/html/class_multimorphic_1_1_p3_s_a_1_1_modes_1_1_data_1_1_p3_s_a_settings_mode.html</span></p><p class="c11"><span class="c13 c9">The interesting members related to versioning are: StoredVersion, DataVersion, DBVersion and InitAttr().</span></p><p class="c11"><span class="c13 c9">Unfortunately, the documentation contains inaccuracies that can be misleading. The following information was discovered experimentally instead.</span></p><p class="c11"><span class="c13 c9">The database version is stored in the database as a hidden game attribute.</span></p><p class="c11"><span class="c13 c9">StoredVersion is the value of the hidden game attribute when the app was started. This value is not updated when the database is recreated. This should have been a local variable. Ignore it completely.</span></p><p class="c11"><span class="c13 c9">The only purpose of DataVersion is to serve as the initial value of the hidden game attribute when not found in the database. This only happens when settings.db is missing, either because the app is started for the first time ever or someone deleted the database for debugging.</span></p><p class="c11"><span class="c13 c9">If the DBVersion is higher than the StoredVersion, the database is rebuilt and the version stored in the database becomes DBVersion. Rebuilding the database means deleting all the contents and storing the latest game attribute declarations as is. In particular, this forgets the user chosen values and restores the GameAttributes to the factory settings.</span></p><p class="c11"><span class="c13 c9">For InitAttr(), the version argument is ignored. The GameAttributeCompareOptions is what determines how the game attribute in the database is merged with the game attribute declared in the app. The GameAttributeCompareOptions are explained in great detail later.</span></p><p class="c11"><span class="c13 c9">It is a good idea to increase the DBVersion when deleting a GameAttribute. Recreating the database will remove the GameAttribute that no longer exists in the code. For most other cases, the GameAttributeCompareOptions can deal with the situation. Some developers might prefer to increase the DBVersion for every change in GameAttributes. This is attractive semantically, but also overwrites all user chosen values every time the version is bumped.</span></p><p class="c11"><span class="c13 c9">The System Manager allows multiple versions of the same app to be installed at the same time. The user might choose to run an older version to compare against the latest version. If the older app has an older DBVersion in P3SASettingsMode, then the newer persisted data will be kept and only the GameAttributeCompareOptions will protect against incompatible changes.</span></p><h2 class="c8"><span class="c24 c9">InitAttr Method</span></h2><p class="c11"><span class="c13 c9">A GameAttribute is created and merged with the existing persisted data by calling the method InitAttr() inherited from the DataManagerMode base class.</span></p><p class="c11"><span class="c13 c9">There are 16 variants of the method InitAttr():</span></p><a id="t.715e970ff247f3090b4e4f6f32b35eada64ee5b4"></a><a id="t.2"></a><table class="c26"><tr class="c30"><td class="c15" colspan="1" rowspan="1"><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">string</span><span class="c7">&nbsp;avalue, </span><span class="c1">string</span><span class="c7">&nbsp;defaultValue, </span><span class="c1">string</span><span class="c7 c9">[] rangeCode);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">bool</span><span class="c7">&nbsp;avalue, </span><span class="c1">bool</span><span class="c7">&nbsp;defaultValue, </span><span class="c1">string</span><span class="c7 c9">[] rangeCode, GameAttributeCompareOptions cmpOptions);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">bool</span><span class="c7">&nbsp;avalue, </span><span class="c1">bool</span><span class="c7">&nbsp;defaultValue, </span><span class="c1">string</span><span class="c7 c9">[] rangeCode);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">bool</span><span class="c7">&nbsp;avalue, </span><span class="c1">bool</span><span class="c7 c9">&nbsp;defaultValue, GameAttributeCompareOptions cmpOptions);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">bool</span><span class="c7">&nbsp;avalue, </span><span class="c1">bool</span><span class="c7 c9">&nbsp;defaultValue);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">float</span><span class="c7">&nbsp;avalue, </span><span class="c1">float</span><span class="c7">&nbsp;minValue, </span><span class="c1">float</span><span class="c7">&nbsp;maxValue, </span><span class="c1">float</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">float</span><span class="c7">&nbsp;defaultValue, </span><span class="c1">string</span><span class="c7 c9">[] rangeCode);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">int</span><span class="c7">&nbsp;avalue, </span><span class="c1">int</span><span class="c7">&nbsp;minValue, </span><span class="c1">int</span><span class="c7">&nbsp;maxValue, </span><span class="c1">int</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">int</span><span class="c7">&nbsp;defaultValue, </span><span class="c1">string</span><span class="c7 c9">[] rangeCode);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">long</span><span class="c7">&nbsp;avalue, </span><span class="c1">long</span><span class="c7">&nbsp;minValue, </span><span class="c1">long</span><span class="c7">&nbsp;maxValue, </span><span class="c1">long</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">long</span><span class="c7 c9">&nbsp;defaultValue, GameAttributeCompareOptions cmpOptions);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">long</span><span class="c7">&nbsp;avalue, </span><span class="c1">long</span><span class="c7">&nbsp;minValue, </span><span class="c1">long</span><span class="c7">&nbsp;maxValue, </span><span class="c1">long</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">long</span><span class="c7 c9">&nbsp;defaultValue);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">float</span><span class="c7">&nbsp;avalue, </span><span class="c1">float</span><span class="c7">&nbsp;minValue, </span><span class="c1">float</span><span class="c7">&nbsp;maxValue, </span><span class="c1">float</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">float</span><span class="c7 c9">&nbsp;defaultValue, GameAttributeCompareOptions cmpOptions);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">float</span><span class="c7">&nbsp;avalue, </span><span class="c1">float</span><span class="c7">&nbsp;minValue, </span><span class="c1">float</span><span class="c7">&nbsp;maxValue, </span><span class="c1">float</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">float</span><span class="c7 c9">&nbsp;defaultValue);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">int</span><span class="c7">&nbsp;avalue, </span><span class="c1">int</span><span class="c7">&nbsp;minValue, </span><span class="c1">int</span><span class="c7">&nbsp;maxValue, </span><span class="c1">int</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">int</span><span class="c7 c9">&nbsp;defaultValue, GameAttributeCompareOptions cmpOptions);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">string</span><span class="c7">&nbsp;avalue, </span><span class="c1">string</span><span class="c7 c9">&nbsp;defaultValue);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">string</span><span class="c7 c9">&nbsp;avalue);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">float</span><span class="c7">&nbsp;avalue, </span><span class="c1">float</span><span class="c7">&nbsp;minValue, </span><span class="c1">float</span><span class="c7">&nbsp;maxValue, </span><span class="c1">float</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">float</span><span class="c7">&nbsp;defaultValue, </span><span class="c1">string</span><span class="c7 c9">[] rangeCode, GameAttributeCompareOptions cmpOptions);</span></p><p class="c5"><span class="c7">protected </span><span class="c1">void</span><span class="c7">&nbsp;InitAttr(</span><span class="c1">int</span><span class="c7">&nbsp;version, </span><span class="c1">string</span><span class="c7">&nbsp;item, </span><span class="c1">string</span><span class="c7">&nbsp;descr, </span><span class="c1">string</span><span class="c7">&nbsp;displayName, </span><span class="c1">string</span><span class="c7">&nbsp;classification, GameAttributeOptions options, </span><span class="c1">int</span><span class="c7">&nbsp;avalue, </span><span class="c1">int</span><span class="c7">&nbsp;minValue, </span><span class="c1">int</span><span class="c7">&nbsp;maxValue, </span><span class="c1">int</span><span class="c7">&nbsp;incrementValue, </span><span class="c1">int</span><span class="c7">&nbsp;defaultValue);</span></p></td></tr></table><p class="c6 c31"><span class="c7 c9"></span></p><h2 class="c19"><span class="c24 c9">GameAttribute Version</span></h2><p class="c17"><span class="c13 c9">Counter-intuitively, the version field of a GameAttribute is always ignored. It is not persisted either. You could pick any value like 1, but it might be more useful to set the version to the database version when that GameAttribute was introduced. This can serve as a form of documentation for the developer</span></p><h2 class="c19"><span class="c9 c24">Classification</span></h2><p class="c17"><span class="c13 c9">The classification is the path in the operator menus where the GameAttribute will appear. By choosing an existing path, this will add the GameAttribute to the existing menu. Choosing a path that does not exist will create new menus.</span></p><p class="c17"><span class="c13 c9">Here is a typical classification for a game settings: &quot;Service Menu/Settings/Gameplay/General&quot;</span></p><p class="c17"><span class="c13 c9">In case you forgot, to access the service menu, open the coin door and press the launch button, then close the coin door. In the simulator, press and hold [ and press l (lowercase L), then navigate up with a, navigate down with ;, navigate back with s, select with l (lowercase L).</span></p><h2 class="c19"><span class="c24 c9">GameAttributeOptions</span></h2><p class="c17"><span class="c13 c9">The definition of GameAttributeOptions is:</span></p><a id="t.8896a47acf121b193d1810edc552ca473773d9f4"></a><a id="t.3"></a><table class="c26"><tr class="c30"><td class="c15" colspan="1" rowspan="1"><p class="c16"><span class="c18">public</span><span class="c3">&nbsp;</span><span class="c18">enum</span><span class="c3">&nbsp;</span><span class="c22">GameAttributeOptions</span></p><p class="c6"><span class="c2">{</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; None = 0,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; ReadWrite = 0,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; ReadOnly = 1,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; Hidden = 2,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; ShowTextValues = 4,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; ProfileOption = 8,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; Action = 16,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; Confirm = 32,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; PlayfieldModule = 64,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; Global = 128</span></p><p class="c20"><span class="c3">}</span></p></td></tr></table><p class="c11 c31"><span class="c13 c9"></span></p><p class="c11"><span class="c13 c9">DataManagerMode defines some shorthands for some common GameAttributeOptions combinations:</span></p><a id="t.4ec4e66d23a6ee2ba0706bb6f88ef53a5e380402"></a><a id="t.4"></a><table class="c26"><tr class="c30"><td class="c15" colspan="1" rowspan="1"><p class="c16"><span class="c3">protected </span><span class="c18">const</span><span class="c2">&nbsp;GameAttributeOptions RW = GameAttributeOptions.None;</span></p><p class="c6"><span class="c3">protected </span><span class="c18">const</span><span class="c2">&nbsp;GameAttributeOptions TV = GameAttributeOptions.ShowTextValues;</span></p><p class="c6"><span class="c3">protected </span><span class="c18">const</span><span class="c2">&nbsp;GameAttributeOptions PRW = GameAttributeOptions.ProfileOption;</span></p><p class="c20"><span class="c3">protected </span><span class="c18">const</span><span class="c3">&nbsp;GameAttributeOptions PTV = GameAttributeOptions.ShowTextValues | GameAttributeOptions.ProfileOption;</span></p></td></tr></table><p class="c11 c31"><span class="c13 c9"></span></p><p class="c11"><span class="c13 c9">A ReadOnly GameAttribute cannot be modified in the service menu, though it can be modified programmatically. This is suitable for a high score for example.</span></p><p class="c11"><span class="c13 c9">A Hidden GameAttribute does not appear in the service menu. This is often done to hardcode the value of a built-in settings. There is an example how to do this in the SDK guide (See P3_SDK_V0.8/P3SampleApp/Documentation/html/_persistent_data.html#CustomizingDefaultGameAttributes). The trick is to retrieve the GameAttribute, set the value and add GameAttributeOptions.Hidden to the GameAttribute options</span></p><p class="c11"><span class="c13 c9">The ShowTextValues option shows text values in the rangeCode array instead of the bool or int value. Notice the values don&rsquo;t have to be integers from 0 to the length of the array - 1. For example, the Difficulty below can be 10, 20 or 30 but displays Easy, Medium or Hard. Unfortunately, I was not able to make the rangeCode work with a float value.</span></p><p class="c6"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; InitAttr(38, </span><span class="c10">&quot;UserProfileEditingEnabled&quot;</span><span class="c3">, </span><span class="c10">&quot;Allow user to edit this profile&quot;</span><span class="c3">, </span><span class="c10">&quot;Allow user to edit this profile&quot;</span><span class="c3">, </span><span class="c10">&quot;Service Menu/Settings/General/Profiles&quot;</span><span class="c3">, PTV, </span><span class="c18">true</span><span class="c3">, </span><span class="c18">true</span><span class="c3">, </span><span class="c18">new</span><span class="c3">&nbsp;</span><span class="c18">string</span><span class="c3">[] {</span><span class="c10">&quot;No&quot;</span><span class="c3">, </span><span class="c10">&quot;Yes&quot;</span><span class="c2">});</span></p><p class="c6"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; InitAttr(38, </span><span class="c10">&quot;Difficulty&quot;</span><span class="c3">, </span><span class="c10">&quot;Difficulty&quot;</span><span class="c3">, </span><span class="c10">&quot;Difficulty&quot;</span><span class="c3">, </span><span class="c10">&quot;Service Menu/Settings/Gameplay/General&quot;</span><span class="c3">, PTV, 10, 10, 30, 10, 10, </span><span class="c18">new</span><span class="c3">&nbsp;</span><span class="c18">string</span><span class="c3">[3] { </span><span class="c10">&quot;Easy&quot;</span><span class="c3">, </span><span class="c10">&quot;Medium&quot;</span><span class="c3">, </span><span class="c10">&quot;Hard&quot;</span><span class="c2">&nbsp;});</span></p><p class="c6 c31"><span class="c2"></span></p><p class="c6"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c9 c29">//ShowTextValues does not work with float values</span></p><p class="c6"><span class="c3">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c29">//InitAttr(38, &quot;Initial Fuel&quot;, &quot;Initial Fuel&quot;, &quot;Initial Fuel&quot;, &quot;Service Menu/Settings/Gameplay/General&quot; PTV, 0.5F, 0F, 1F, 0.5F, 0.5F, new string[3] { &quot;Empty&quot;, &quot;Half&quot;, &quot;Full&quot; });</span></p><p class="c11 c31"><span class="c13 c9"></span></p><p class="c11"><span class="c9 c13">The ProfileOption means the GameAttribute is stored in the profile, therefore it can differ between players if they use different profiles. This can be used to adjust the difficulty depending on the players&rsquo; skill. Some options like pricing and replay thresholds don&rsquo;t make sense in a profile, therefore choosing whether a GameAttribute belongs in the profile really depends on what the GameAttribute does. Caching of GameAttributes can be tricky and error prone. It is simpler to retrieve the value every time it is needed. This will automatically take care of GameAttributes that can differ per profile. </span></p><p class="c11"><span class="c13 c9">An Action GameAttribute is not editable. When attempting to edit the value, the event Evt_SaveGameAttribute is sent as if the value was already selected. The intent is for the GameAttribute to trigger the execution of some code in the application.</span></p><p class="c11"><span class="c13 c9">Enabling the Confirm option tells the service menu to ask for confirmation before truly setting the GameAttribute value.</span></p><p class="c11"><span class="c13 c9">The PlayfieldModule option documents the settings is module specific. This does not appear to have specific behavior attached to it.</span></p><p class="c11"><span class="c13 c9">The Global option documents the settings is global to the whole platform. This does not appear to have specific behavior either.</span></p><p class="c6"><span class="c24">GameAttributeCompareOptions</span></p><p class="c17"><span class="c13 c9">The definition of GameAttributeCompareOptions is:</span></p><a id="t.5b1387fcf4084f966734664b57b3b109d18603c8"></a><a id="t.5"></a><table class="c26"><tr class="c30"><td class="c15" colspan="1" rowspan="1"><p class="c16"><span class="c18">public</span><span class="c3">&nbsp;</span><span class="c18">enum</span><span class="c3">&nbsp;</span><span class="c22">GameAttributeCompareOptions</span></p><p class="c6"><span class="c2">{</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; CompareNone = 1,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; CompareAll = 2,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; CompareAllExceptValue = 4,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; UpdateValueIfAnyChange = 8,</span></p><p class="c6"><span class="c2">&nbsp; &nbsp; UpdateValueIfDefaultChanged = 16</span></p><p class="c20"><span class="c3">}</span></p></td></tr></table><p class="c11 c31"><span class="c13 c9"></span></p><p class="c11"><span class="c13 c9">For the InitAttr() variants that don&rsquo;t take a GameAttributeCompareOptions argument, the default is GameAttributeCompareOptions.CompareAllExceptValue.</span></p><p class="c11"><span class="c13 c9">Notice there is no variant with GameAttributeCompareOptions for an int value. The compiler will choose the variant for a long value instead.</span></p><p class="c11"><span class="c13 c9">The GameAttribute has a current value and a defaultValue. The defaultValue is not treated specially in the operator menu. Its purpose is more subtle and will be described later.</span></p><p class="c11"><span class="c13 c9">InitAttr() creates the GameAttribute and merges it with the existing persistent data. The guiding principle is to always adopt the latest definition while preserving the user chosen value when possible.</span></p><p class="c11"><span class="c13 c9">If this is the first time the GameAttribute is created, it does not exist in the persistent data, therefore it can be persisted as is.</span></p><p class="c11"><span class="c13 c9">If the GameAttribute was created previously, it already exists in the persistent data, therefore it must be merged before the new definition can be persisted. Of course, if nothing changed, there is nothing to merge, but in general, the definition of the GameAttribute could have changed, forcing a merge. </span></p><p class="c11"><span class="c13 c9">The GameAttribute is compared to the persistent data according to the GameAttributeCompareOptions of the newly created GameAttribute. The GameAttributeCompareOptions of the persisted data is not relevant.</span></p><p class="c11"><span class="c13 c9">The options are:</span></p><ul class="c21 lst-kix_list_3-0 start"><li class="c0 li-bullet-0"><span class="c13 c9">CompareNone means none of the fields are compared</span></li><li class="c0 li-bullet-0"><span class="c13 c9">CompareAll means compare all fields except the version and the compareOptions</span></li><li class="c11 c12 li-bullet-0"><span class="c13 c9">CompareAllExceptValue means compare all fields except the version, the compareOptions and the current value.</span></li></ul><p class="c11"><span class="c13 c9">Let&rsquo;s go through all the cases.</span></p><ul class="c21 lst-kix_list_3-0"><li class="c0 li-bullet-0"><span class="c13 c9">When the compareOptions include CompareNone, the GameAttribute always compares equal to the persistent data and the definition will never be updated after the first time it is persisted. Upgrading this GameAttribute will require upgrading the DBVersion.</span></li><li class="c0 li-bullet-0"><span class="c13 c9">When the compareOptions include CompareAll or CompareAllExceptValue and all the applicable fields compare equal, then the GameAttribute is considered the same as the persistent data, therefore the persistent data is kept as is.</span></li><li class="c0 li-bullet-0"><span class="c13 c9">When the compareOptions include CompareAll or CompareAllExceptValue and at least one of the applicable fields compare unequal, then the GameAttribute is considered upgraded and must be merged with the persistent data as follows:</span></li></ul><ul class="c21 lst-kix_list_3-1 start"><li class="c4 li-bullet-0"><span class="c13 c9">If the data type has changed, the persisted value is not applicable, therefore the new GameAttribute definition is persisted as is.</span></li><li class="c4 li-bullet-0"><span class="c13 c9">If the data type is the same and the compareOptions do not include UpdateValueIfAnyChange or UpdateValueIfDefaultChanged, then assign the persisted value to the new GameAttribute current value and persist that new modified GameAttribute.</span></li><li class="c4 li-bullet-0"><span class="c13 c9">If the data type is the same and the compareOptions include UpdateValueIfAnyChange, then assign the new GameAttribute defaultValue to the new GameAttribute current value and persist that new modified GameAttribute. Notice UpdateValueIfAnyChange is always satisfied since that&rsquo;s how we got here in the first place. Logically though, the comparison for UpdateValueIfAnyChange was done over the applicable fields selected by CompareAll or CompareAllExceptValue.</span></li><li class="c11 c32 li-bullet-0"><span class="c13 c9">If the data type is the same and the compareOptions include UpdateValueIfDefaultChanged and the new GameAttribute default value differs from the persisted default value, then assign the new GameAttribute defaultValue to the new GameAttribute current value and persist that new modified GameAttribute.</span></li></ul><p class="c11"><span class="c13 c9">In practice, the default CompareAllExceptValue is a good choice because it accepts upgrades to the GameAttribute definitions while preserving the user chosen value.</span></p><p class="c11"><span class="c13 c9">The option UpdateValueIfAnyChange is useful when at least one previously valid value is no longer valid in the new GameAttribute definition. When combined with CompareAll or CompareAllExceptValue, the persisted data will compare unequal, forcing the value to be overwritten by the defaultValue. This ensures the new persisted value is always valid for the new GameAttribute definition. This may overwrite a valid value but it is much simpler than the alternative to write custom code. An even simpler solution is to upgrade the DBVersion to force a database rebuild.</span></p><p class="c11"><span class="c13 c9">The option UpdateValueIfDefaultChanged might be better suited for high score GameAttributes. Let me know if I&rsquo;m missing another obvious use case.</span></p><p class="c11"><span class="c13 c9">The options UpdateValueIfAnyChange or UpdateValueIfDefaultChanged do nothing when not combined with CompareAll or CompareAllExceptValue. I believe there is a problem with this statement in P3SASettingsMode:</span></p><p class="c11"><span class="c13 c9">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attr.compareOptions = GameAttributeCompareOptions.UpdateValueIfDefaultChanged;</span></p><p class="c11"><span class="c13 c9">The statement should probably be:</span></p><p class="c11"><span class="c13 c9">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; attr.compareOptions = GameAttributeCompareOptions.CompareAllExceptValue | GameAttributeCompareOptions.UpdateValueIfDefaultChanged;</span></p><p class="c11"><span class="c13 c9">There is only one place that I know of where the SDK makes use of the defaultValue. Going in the service menu and assigning Yes to &ldquo;Service Menu/Statistics/ResetScores&ldquo; will reset the high score GameAttributes to their default values.</span></p><p class="c11"><span class="c13 c9">The defaultValue could also be used to return to &ldquo;factory settings&rdquo;, but I don&rsquo;t know if that option is even available to the user.</span></p><p class="c11"><span class="c13 c9">I suggest to always set the value equal to the defaultValue in InitAttr() and forget about the defaultValue afterwards. The defaultValue is relevant only with UpdateValueIfAnyChange or UpdateValueIfDefaultChanged, and if the value is overwritten with the defaultValue, that strategy keeps the value the same and is therefore equivalent to persisting the new GameAttribute as is.</span></p></body></html>