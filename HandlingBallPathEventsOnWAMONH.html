<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=fpjTOVmNbO4Lz34iLyptLUXza5VhXqVC6o75Eld_V98);.lst-kix_list_2-6>li:before{content:"" counter(lst-ctn-kix_list_2-6,decimal) ". "}.lst-kix_list_2-7>li:before{content:"" counter(lst-ctn-kix_list_2-7,lower-latin) ". "}.lst-kix_list_2-7>li{counter-increment:lst-ctn-kix_list_2-7}.lst-kix_list_2-1>li{counter-increment:lst-ctn-kix_list_2-1}ul.lst-kix_list_1-0{list-style-type:none}.lst-kix_list_2-4>li:before{content:"" counter(lst-ctn-kix_list_2-4,lower-latin) ". "}.lst-kix_list_2-5>li:before{content:"" counter(lst-ctn-kix_list_2-5,lower-roman) ". "}.lst-kix_list_2-8>li:before{content:"" counter(lst-ctn-kix_list_2-8,lower-roman) ". "}ol.lst-kix_list_2-6.start{counter-reset:lst-ctn-kix_list_2-6 0}.lst-kix_list_3-0>li:before{content:"\0025cf   "}.lst-kix_list_3-1>li:before{content:"o  "}.lst-kix_list_3-2>li:before{content:"\0025aa   "}ul.lst-kix_list_3-7{list-style-type:none}ul.lst-kix_list_3-8{list-style-type:none}ol.lst-kix_list_2-3.start{counter-reset:lst-ctn-kix_list_2-3 0}ul.lst-kix_list_1-3{list-style-type:none}ul.lst-kix_list_3-1{list-style-type:none}.lst-kix_list_3-5>li:before{content:"\0025aa   "}ul.lst-kix_list_1-4{list-style-type:none}ul.lst-kix_list_3-2{list-style-type:none}ul.lst-kix_list_1-1{list-style-type:none}.lst-kix_list_3-4>li:before{content:"o  "}ul.lst-kix_list_1-2{list-style-type:none}ul.lst-kix_list_3-0{list-style-type:none}ul.lst-kix_list_1-7{list-style-type:none}.lst-kix_list_3-3>li:before{content:"\0025cf   "}ul.lst-kix_list_3-5{list-style-type:none}ul.lst-kix_list_1-8{list-style-type:none}ul.lst-kix_list_3-6{list-style-type:none}ul.lst-kix_list_1-5{list-style-type:none}ul.lst-kix_list_3-3{list-style-type:none}ul.lst-kix_list_1-6{list-style-type:none}ul.lst-kix_list_3-4{list-style-type:none}ol.lst-kix_list_2-5.start{counter-reset:lst-ctn-kix_list_2-5 0}.lst-kix_list_3-8>li:before{content:"\0025aa   "}.lst-kix_list_2-0>li{counter-increment:lst-ctn-kix_list_2-0}.lst-kix_list_4-0>li:before{content:"-  "}.lst-kix_list_2-3>li{counter-increment:lst-ctn-kix_list_2-3}.lst-kix_list_2-6>li{counter-increment:lst-ctn-kix_list_2-6}.lst-kix_list_4-1>li:before{content:"o  "}.lst-kix_list_3-6>li:before{content:"\0025cf   "}.lst-kix_list_3-7>li:before{content:"o  "}.lst-kix_list_4-4>li:before{content:"o  "}ol.lst-kix_list_2-2.start{counter-reset:lst-ctn-kix_list_2-2 0}.lst-kix_list_4-3>li:before{content:"\0025cf   "}.lst-kix_list_4-5>li:before{content:"\0025aa   "}.lst-kix_list_4-2>li:before{content:"\0025aa   "}.lst-kix_list_4-6>li:before{content:"\0025cf   "}ol.lst-kix_list_2-2{list-style-type:none}ol.lst-kix_list_2-3{list-style-type:none}ol.lst-kix_list_2-4{list-style-type:none}ol.lst-kix_list_2-5{list-style-type:none}ol.lst-kix_list_2-0{list-style-type:none}.lst-kix_list_2-4>li{counter-increment:lst-ctn-kix_list_2-4}ol.lst-kix_list_2-1{list-style-type:none}.lst-kix_list_4-8>li:before{content:"\0025aa   "}.lst-kix_list_4-7>li:before{content:"o  "}ul.lst-kix_list_4-8{list-style-type:none}ul.lst-kix_list_4-6{list-style-type:none}ul.lst-kix_list_4-7{list-style-type:none}ol.lst-kix_list_2-8.start{counter-reset:lst-ctn-kix_list_2-8 0}ul.lst-kix_list_4-0{list-style-type:none}ul.lst-kix_list_4-1{list-style-type:none}.lst-kix_list_1-0>li:before{content:"-  "}ul.lst-kix_list_4-4{list-style-type:none}ol.lst-kix_list_2-6{list-style-type:none}ul.lst-kix_list_4-5{list-style-type:none}.lst-kix_list_1-1>li:before{content:"o  "}.lst-kix_list_1-2>li:before{content:"\0025aa   "}ol.lst-kix_list_2-0.start{counter-reset:lst-ctn-kix_list_2-0 0}ol.lst-kix_list_2-7{list-style-type:none}ul.lst-kix_list_4-2{list-style-type:none}ol.lst-kix_list_2-8{list-style-type:none}ul.lst-kix_list_4-3{list-style-type:none}.lst-kix_list_1-3>li:before{content:"\0025cf   "}.lst-kix_list_1-4>li:before{content:"o  "}.lst-kix_list_1-7>li:before{content:"o  "}ol.lst-kix_list_2-7.start{counter-reset:lst-ctn-kix_list_2-7 0}.lst-kix_list_1-5>li:before{content:"\0025aa   "}.lst-kix_list_1-6>li:before{content:"\0025cf   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_list_2-0>li:before{content:"" counter(lst-ctn-kix_list_2-0,decimal) "- "}.lst-kix_list_2-1>li:before{content:"" counter(lst-ctn-kix_list_2-1,lower-latin) ". "}ol.lst-kix_list_2-1.start{counter-reset:lst-ctn-kix_list_2-1 0}.lst-kix_list_2-5>li{counter-increment:lst-ctn-kix_list_2-5}.lst-kix_list_2-8>li{counter-increment:lst-ctn-kix_list_2-8}.lst-kix_list_1-8>li:before{content:"\0025aa   "}.lst-kix_list_2-2>li:before{content:"" counter(lst-ctn-kix_list_2-2,lower-roman) ". "}.lst-kix_list_2-3>li:before{content:"" counter(lst-ctn-kix_list_2-3,decimal) ". "}.lst-kix_list_2-2>li{counter-increment:lst-ctn-kix_list_2-2}ol.lst-kix_list_2-4.start{counter-reset:lst-ctn-kix_list_2-4 0}ol{margin:0;padding:0}table td,table th{padding:0}.c10{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:467.5pt;border-top-color:#000000;border-bottom-style:solid}.c5{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:828pt;border-top-color:#000000;border-bottom-style:solid}.c16{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:831pt;border-top-color:#000000;border-bottom-style:solid}.c13{border-right-style:solid;padding:0pt 5.4pt 0pt 5.4pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:610.9pt;border-top-color:#000000;border-bottom-style:solid}.c9{color:#2f5496;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Calibri";font-style:normal}.c3{padding-top:12pt;padding-bottom:0pt;line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.c7{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Calibri";font-style:normal}.c1{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:8pt;font-family:"Courier New";font-style:normal}.c17{padding-top:6pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c18{padding-top:0pt;padding-bottom:8pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c14{padding-top:0pt;padding-bottom:6pt;line-height:1.0;orphans:2;widows:2;text-align:left}.c12{border-spacing:0;border-collapse:collapse;margin-right:auto}.c19{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#0563c1;text-decoration:underline}.c8{background-color:#ffffff;max-width:828pt;padding:36pt 144pt 36pt 36pt}.c0{padding:0;margin:0}.c15{color:inherit;text-decoration:inherit}.c11{margin-left:36pt;padding-left:0pt}.c20{margin-right:-3pt}.c4{height:11pt}.c6{height:0pt}.title{padding-top:24pt;color:#000000;font-weight:700;font-size:36pt;padding-bottom:6pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:18pt;color:#666666;font-size:24pt;padding-bottom:4pt;font-family:"Georgia";line-height:1.0791666666666666;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Calibri"}p{margin:0;color:#000000;font-size:11pt;font-family:"Calibri"}h1{padding-top:12pt;color:#2f5496;font-size:16pt;padding-bottom:0pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-weight:700;font-size:18pt;padding-bottom:4pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:14pt;color:#000000;font-weight:700;font-size:14pt;padding-bottom:4pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:12pt;color:#000000;font-weight:700;font-size:12pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:11pt;color:#000000;font-weight:700;font-size:11pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:10pt;color:#000000;font-weight:700;font-size:10pt;padding-bottom:2pt;font-family:"Calibri";line-height:1.0791666666666666;page-break-after:avoid;orphans:2;widows:2;text-align:left}</style></head><body class="c8 doc-content"><p class="c2 c4"><span class="c7"></span></p><h1 class="c3"><span class="c9">Handling BallPath Events on WAMONH</span></h1><p class="c2"><span class="c7">(This tech tip was written when the latest version of the SDK was P3_SDK_V0.8)</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">BallPaths allow a game to make use of module-specific shots without previous knowledge of the upper playfield. BallPaths are described in the module definition file and implemented by the module driver.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">The SDK documentation describes the syntax of a BallPath definition here: P3_SDK_V0.8/P3SampleApp/Documentation/html/_creating_playfield_module.html#BallPaths</span></p><p class="c2"><span class="c7">The SDK documentation gives an example how to handle BallPath events here P3_SDK_V0.8/P3SampleApp/Documentation/html/_physical_features.html#DetectingShotsViaBallPaths</span></p><p class="c2"><span class="c7">That snippet of code also appears in the HomeMode constructor in P3_SDK_V0.8/P3SampleApp/Assets/Scripts/Modes/SceneModes/HomeMode.cs</span></p><p class="c2"><span class="c7">It is reproduced below:</span></p><p class="c2 c4"><span class="c7"></span></p><a id="t.2752681d96af80139e0b47c636c777704297526b"></a><a id="t.0"></a><table class="c12"><tr class="c6"><td class="c5" colspan="1" rowspan="1"><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">// Here&#39;s an example of how to subscribe to generically-defined BallPaths in the playfield module drivers.</span></p><p class="c2"><span class="c1">// You might use code like this if you want your game to work with all playfield modules or if you want</span></p><p class="c2"><span class="c1">// to use the module drivers detection logic for when playfield shots, targets, holes, etc are hit.</span></p><p class="c2"><span class="c1">foreach (BallPathDefinition shot in p3.BallPaths.Values)</span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; if (shot.ExitType == BallPathExitType.Target)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; string[] strippedSwitchName = shot.StartedEvent.Split(&#39;_&#39;); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;// format of switch event must be &quot;sw_&lt;switch name&gt;_active&quot; for started events</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; string swName = strippedSwitchName[1];</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; add_switch_handler(swName, &quot;active&quot;, 0, TargetHitEventHandler);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; else if (shot.ExitType != BallPathExitType.Hole)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.Log(Multimorphic.P3App.Logging.LogCategories.Game, &quot;Installing ShotHitHandler for : &quot; + shot.CompletedEvent + &quot; exitType: &quot; + shot.ExitType.ToString());</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddModeEventHandler(shot.CompletedEvent, ShotHitEventHandler, priority);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; else</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.Log(Multimorphic.P3App.Logging.LogCategories.Game, &quot;Installing HoleHitHandler for : &quot; + shot.CompletedEvent);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddModeEventHandler(shot.CompletedEvent, HoleHitEventHandler, priority);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c1"></span></p></td></tr></table><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">In HomeMode.cs, you can see the signature of the event handlers:</span></p><p class="c2 c4"><span class="c7"></span></p><a id="t.bae683a7dda6667b88b9c064b2d830d128b8e4fa"></a><a id="t.1"></a><table class="c12"><tr class="c6"><td class="c10" colspan="1" rowspan="1"><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">private bool TargetHitEventHandler(Switch sw)</span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; // Add target hit logic here</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; return SWITCH_CONTINUE;</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">private bool ShotHitEventHandler(string evtName, object evtData)</span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; // Add shot hit logic</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; return SWITCH_CONTINUE;</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">private bool HoleHitEventHandler(string evtName, object evtData)</span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; // Add hole hit logic here</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; return SWITCH_CONTINUE;</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c7"></span></p></td></tr></table><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">This code can handle these two BallPaths in Heist.json</span></p><p class="c2 c4"><span class="c7"></span></p><a id="t.0e39f035efeb17e8d65e46e04ebf45d8589061ff"></a><a id="t.2"></a><table class="c12"><tr class="c6"><td class="c13" colspan="1" rowspan="1"><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &quot;Name&quot;: &quot;RightJailTarget&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;Tags&quot;: [&quot;Target&quot;],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitType&quot;: &quot;Target&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntranceName&quot;: &quot;RightJailTarget&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitName&quot;: &quot;RightJailTarget&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;StartedEvent&quot;: &quot;sw_RightJailTarget_active&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;CompletedEvent&quot;: &quot;sw_RightJailTarget_inactive&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntrancePosition&quot;: [11.5,5,0],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitPosition&quot;: [11.5,5,0],</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntranceLEDs&quot;: [[&quot;jailRight&quot;],],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitLEDs&quot;: [[&quot;&quot;],],</span></p><p class="c2"><span class="c1">},</span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &quot;Name&quot;: &quot;RightOuterLoopToHole&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;Tags&quot;: [&quot;Loop&quot;],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitType&quot;: &quot;Hole&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntranceName&quot;: &quot;RightOuterLoop&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitName&quot;: &quot;Hole&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;StartedEvent&quot;: &quot;Evt_RightOuterLoopStarted&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;CompletedEvent&quot;: &quot;Evt_Shot_RightOuterLoopToHole&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntrancePosition&quot;: [18,0,0],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitPosition&quot;: [NaN,NaN,NaN],</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntranceLEDs&quot;: [[&quot;rightOuterOrbitDown&quot;,&quot;lab&quot;,&quot;storage0&quot;,&quot;storage1&quot;,&quot;storage2&quot;,&quot;storage3&quot;,&quot;storage4&quot;,&quot;storage5&quot;,&quot;storageAndKey&quot;,&quot;bigLock&quot;],],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitLEDs&quot;: [[&quot;&quot;],],</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c7"></span></p></td></tr></table><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">This code assumes the StartedEvent of a Target BallPath must be a switch event with the syntax &ldquo;sw_&lt;switch name&gt;_active&rdquo; and the CompletedEvent of other BallPaths must be a regular mode event.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">The sample code does not show this, but from the Heist definitions above, we can infer the CompletedEvent of a Target BallPath must be a switch event with the syntax &ldquo;sw_&lt;switch name&gt;_inactive&rdquo; and the StartedEvent of other BallsPaths must be a regular mode event.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">In the event handlers:</span></p><ul class="c0 lst-kix_list_4-0 start"><li class="c2 c11 li-bullet-0"><span class="c7">The Switch argument is guaranteed to be the switch that changed state.</span></li><li class="c2 c11 li-bullet-0"><span class="c7">The evtName argument is the event name.</span></li><li class="c2 c11 li-bullet-0"><span class="c7">The evtData argument differs depending on the module driver and thus cannot be easily interpreted in a module agnostic way. The value is typically not useful and can be ignored.</span></li></ul><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">Somewhat confusingly, the Heist module driver also sends a regular mode event for a Target BallPath. More specifically, it will send the mode event &ldquo;sw_&lt;switch name&gt;_active&rdquo; when the target becomes active, and it will send the mode event &ldquo;sw_&lt;switch name&gt;_inactive&rdquo; when the target becomes inactive. Heist is the only module driver that does this. Earlier module drivers rely exclusively on the switch handlers. If you want to support the earlier modules, might as well stick to switch events for Target BallPaths.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">When WAMONH came out, the Target BallPaths used mode events instead of switch events, therefore breaking the convention.</span></p><p class="c2 c4"><span class="c7"></span></p><a id="t.6749b2f817d4010bef36a24232f7420fe853eb5b"></a><a id="t.3"></a><table class="c12"><tr class="c6"><td class="c10" colspan="1" rowspan="1"><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &quot;Name&quot;: &quot;FoodTargetR&quot;, </span></p><p class="c2"><span class="c1">&nbsp; &quot;Tags&quot;: [&quot;Static&quot;, &quot;Target&quot;],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitType&quot;: &quot;Target&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntranceName&quot;: &quot;FoodTargetR&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitName&quot;: &quot;FoodTargetR&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;StartedEvent&quot;: &quot;Evt_ShotStarted_FoodTargetR&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;CompletedEvent&quot;: &quot;Evt_ShotMade_FoodTargetR&quot;,</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntrancePosition&quot;: [4,15,4],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitPosition&quot;: [NaN,NaN,NaN],</span></p><p class="c2"><span class="c1">&nbsp; &quot;EntranceLEDs&quot;: [[&quot;FoodR&quot;],],</span></p><p class="c2"><span class="c1">&nbsp; &quot;ExitLEDs&quot;: [[&quot;&quot;],],</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c1"></span></p></td></tr></table><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">The documentation and P3SampleApp were not updated in P3_SDK_V0.8.</span></p><p class="c2"><span class="c7">The sample code in the documentation and HomeMode cannot handle this BallPath definition.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c18"><span>Gerry proposed this replacement code in the </span><span class="c19"><a class="c15" href="https://discord.com/channels/730055502557610004/1103500060823666719/1103903417992216688">P3 Community Discord</a></span><span class="c7">&nbsp;on May 5 2023:</span></p><a id="t.9d86dab13d1a34075690ede5e8b1d61435320667"></a><a id="t.4"></a><table class="c12"><tr class="c6"><td class="c16" colspan="1" rowspan="1"><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">foreach (BallPathDefinition shot in p3.BallPaths.Values)</span></p><p class="c2"><span class="c1">{</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; if (shot.ExitType == BallPathExitType.Target)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // If the completed event looks like a standard switch handler definition,</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // parse and add a normal switch handler. &nbsp;Otherwise, use the completed event</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; // with a mode2mode handler.</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; if (shot.CompletedEvent.Contains(&quot;_inactive&quot;))</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c2 c20"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string[] strippedSwitchName = shot.CompletedEvent.Split(&#39;_&#39;); &nbsp; &nbsp;// format of switch event must be &quot;sw_&lt;switch name&gt;_active&quot; for started events</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; string swName = strippedSwitchName[1];</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; add_switch_handler(swName, &quot;active&quot;, 0, TargetHitEventHandler);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; else</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; AddModeEventHandler(shot.CompletedEvent, TargetPathHitEventHandler, priority);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; else if (shot.ExitType != BallPathExitType.Hole)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.Log(Multimorphic.P3App.Logging.LogCategories.Game, &quot;Installing ShotHitHandler for : &quot; + shot.CompletedEvent + &quot; exitType: &quot; + shot.ExitType.ToString());</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddModeEventHandler(shot.CompletedEvent, ShotHitEventHandler, priority);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; else</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; Multimorphic.P3App.Logging.Logger.Log(Multimorphic.P3App.Logging.LogCategories.Game, &quot;Installing HoleHitHandler for : &quot; + shot.CompletedEvent);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; AddModeEventHandler(shot.CompletedEvent, HoleHitEventHandler, priority);</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; }</span></p><p class="c2"><span class="c1">}</span></p><p class="c2 c4"><span class="c7"></span></p></td></tr></table><p class="c2 c4"><span class="c7"></span></p><p class="c18"><span class="c7">The TargetPathHitEventHandler method can be implemented like this:</span></p><a id="t.b8a1dcc423f182c064ec23cd291c6821827d579f"></a><a id="t.5"></a><table class="c12"><tr class="c6"><td class="c16" colspan="1" rowspan="1"><p class="c17"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; private bool TargetPathHitEventHandler(string evtName, object evtData)</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; {</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // Add target path hit logic here or move the subscription and this code into a relevant child mode to process target path hits</span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; // for your game.</span></p><p class="c2 c4"><span class="c1"></span></p><p class="c2"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; return SWITCH_CONTINUE;</span></p><p class="c14"><span class="c1">&nbsp; &nbsp; &nbsp; &nbsp; }</span></p></td></tr></table><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">This sample code can handle BallPaths for all modules currently shipping as of May 16 2023.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">Notice the new code handles the CompletedEvent of Target BallPaths when it is a mode event because it cannot make any assumption on how the shot is implemented. When the Target BallPath is using the switch event syntax, it can install a handler for the StartedEvent as the previous code did because it knows the shot is a single switch.</span></p><p class="c2 c4"><span class="c7"></span></p><p class="c2"><span class="c7">This fix was applied to HomeMode in P3EmptyGame V0.8.1</span></p><p class="c2 c4"><span class="c7"></span></p></body></html>
